
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GitHub Data for OpenShift Origins &#8212; AI Supported Continuous Integration</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Sippy Export of OpenShift Data - EDA" href="../Sippy/stage/sippy_EDA.html" />
    <link rel="prev" title="Bugzilla Data for CI Tests on Testgrid" href="../Bugzilla/bugzilla_EDA.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      
      <h1 class="site-logo" id="site-title">AI Supported Continuous Integration</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../README.html">
   AI4CI : AI for Continuous Integration
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../docs/get-started.html">
   Get Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../docs/how-to-contribute.html">
   Contribute to the AI for Continuous Integration Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../docs/content.html">
   Table of Contents
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Failure type classifier
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../failure-type-classification/README.html">
   Failure type classification with the TestGrid data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../failure-type-classification/testgrid_flakiness_detection.html">
   Flake Detection for TestGrid
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../failure-type-classification/failure_type_classifier.html">
   Failure type classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../failure-type-classification/failure_type_functions.html">
   Failure type functions
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Time to merge prediction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../time-to-merge-prediction/README.html">
   Time to Merge Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../time-to-merge-prediction/time_to_merge_model.html">
   Predicting Time to Merge of a Pull Request
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../time-to-merge-prediction/model_inference.html">
   Time to Merge Prediction Inference Service
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Build Log Classifier
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../gcsweb-ci/build-logs/build_log_EDA.html">
   openshift-ci: build logs initial data collection and EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../gcsweb-ci/build-logs/build_log_term_freq.html">
   Term frequency analysis of build logs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../gcsweb-ci/build-logs/model_seldon.html">
   Seldon deployment for build log clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../gcsweb-ci/prow_archive_discovery.html">
   Prow Logs and GCS Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  TestGrid data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../TestGrid/testgrid_EDA.html">
   TestGrid: initial EDA and data collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TestGrid/testgrid_indepth_EDA.html">
   TestGrid In-Depth EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TestGrid/testgrid_metadata_EDA.html">
   TestGrid: exploring in-depth metadata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../TestGrid/background/testgrid_feature_confirmation.html">
   TestGrid Additional Features - uniform or unique?
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../TestGrid/metrics/README.html">
   KPI Metrics
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/number_of_flakes.html">
     Quantify Flakes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/build_pass_failure.html">
     Quantify Build Pass/Failure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/correlated_failures.html">
     Correlated test failure sets per test and average size of correlation sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/blocked_timed_out.html">
     Tests Blocked and Timed Out Tests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/pct_fixed_each_ts.html">
     Percent of Failing Tests Fixed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/persistent_failures_analysis.html">
     Persistent Failures Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/probability_to_fail.html">
     Probability To Fail
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/test_pass_failures.html">
     Quantify test pass/failures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/time_to_test.html">
     Quantify Time to Test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/time_to_fail.html">
     Time to Fail
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/validate_pipeline.html">
     Validate the succesful running of the Automated Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/get_raw_data.html">
     Fetch test grid data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/metric_template.html">
     {Metric name}
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../TestGrid/metrics/metric_visualization_generic.html">
     KPI Metrics Visualization
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Bugzilla Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Bugzilla/bugzilla_EDA.html">
   Bugzilla Data for CI Tests on Testgrid
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Github Repo PR data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   GitHub Data for OpenShift Origins
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Sippy data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Sippy/stage/sippy_EDA.html">
   Sippy Export of OpenShift Data - EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Sippy/stage/sippy-analysis.html">
   SIPPY
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Sippy/sippy_failure_correlation.html">
   Initial EDA
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Telemetry data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Telemetry/telemetry_EDA.html">
   Telemetry Data for CI Clusters
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/notebooks/data-sources/oc-github-repo/github_PR_EDA.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/aicoe-aiops/ocp-ci-analysis"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/aicoe-aiops/ocp-ci-analysis/issues/new?title=Issue%20on%20page%20%2Fnotebooks/data-sources/oc-github-repo/github_PR_EDA.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href=" /v2/gh/aicoe-aiops/ocp-ci-analysis/master?urlpath=lab/tree/notebooks/data-sources/oc-github-repo/github_PR_EDA.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://jupyterhub-opf-jupyterhub.apps.smaug.na.operate-first.cloud/hub/user-redirect/git-pull?repo=https://github.com/aicoe-aiops/ocp-ci-analysis&urlpath=lab/tree/ocp-ci-analysis/notebooks/data-sources/oc-github-repo/github_PR_EDA.ipynb&branch=master"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   GitHub Data for OpenShift Origins
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-collection">
     Data Collection
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#inspect-the-dataset">
     Inspect the dataset
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#available-fields">
       <strong>
        Available Fields
       </strong>
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#feature-engineering">
     Feature engineering
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#add-pr-ttm-class-column">
       Add PR TTM Class Column
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluating-feature-importances">
     Evaluating Feature Importances
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#categorical-features">
       Categorical Features
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#numerical-features">
       Numerical Features
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#count-vector-type-features">
       Count Vector Type Features
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-feature-engineered-dataset">
     Save Feature Engineered Dataset
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#save-results-to-ceph-or-locally">
     Save results to Ceph or locally
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conlusion">
   Conlusion
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="github-data-for-openshift-origins">
<h1>GitHub Data for OpenShift Origins<a class="headerlink" href="#github-data-for-openshift-origins" title="Permalink to this headline">¶</a></h1>
<p>In this notebook we will quickly walk through how to access and start analyzing the PR data for the OpenShift origins repository. We also explore the various fields in the PR dataset and the features that we can derive from them in order to frame an <a class="reference external" href="https://github.com/aicoe-aiops/ocp-ci-analysis/issues/236">ML problem</a> where we predict the time taken to merge a PR.</p>
<p>The ultimate hope for this work is that we will be able to connect the Github data (code changes) directly with the Bugs, Telemetry, TestGrid and Prow datasets in order to develop a complete picture of the OpenShift CI process.</p>
<div class="section" id="data-collection">
<h2>Data Collection<a class="headerlink" href="#data-collection" title="Permalink to this headline">¶</a></h2>
<p>The Thoth team already developed a tool for collecting data and perfoming analysis on GitHub repositoreis, <a class="reference external" href="https://github.com/thoth-station/mi-scheduler">MI-Scheduler</a>. So, we will not be accessing the data directly from GitHub, but from ceph storage after requesting that the OpenShift/Origin repo be included in the MI-Scheduler tool (see <a class="reference external" href="https://github.com/thoth-station/mi-scheduler/issues/130">issue</a> for details).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="k">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">Counter</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">wordcloud</span> <span class="k">import</span> <span class="n">STOPWORDS</span>

<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">SelectKBest</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">chi2</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="k">import</span> <span class="n">mutual_info_classif</span><span class="p">,</span> <span class="n">f_classif</span>

<span class="kn">from</span> <span class="nn">dotenv</span> <span class="k">import</span> <span class="n">load_dotenv</span><span class="p">,</span> <span class="n">find_dotenv</span>

<span class="n">metric_template_path</span> <span class="o">=</span> <span class="s2">&quot;../TestGrid/metrics&quot;</span>
<span class="k">if</span> <span class="n">metric_template_path</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">metric_template_path</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">ipynb.fs.defs.metric_template</span> <span class="k">import</span> <span class="p">(</span>  <span class="c1"># noqa: E402</span>
    <span class="n">CephCommunication</span><span class="p">,</span>
    <span class="n">save_to_disk</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)})</span>
<span class="n">load_dotenv</span><span class="p">(</span><span class="n">find_dotenv</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## CEPH Bucket variables</span>
<span class="c1">## Create a .env file on your local with the correct configs,</span>
<span class="n">s3_endpoint_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_ENDPOINT&quot;</span><span class="p">)</span>
<span class="n">s3_access_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_ACCESS_KEY&quot;</span><span class="p">)</span>
<span class="n">s3_secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_SECRET_KEY&quot;</span><span class="p">)</span>
<span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_BUCKET&quot;</span><span class="p">)</span>
<span class="n">s3_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_PROJECT_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;github&quot;</span><span class="p">)</span>
<span class="n">s3_input_data_path</span> <span class="o">=</span> <span class="s2">&quot;raw_data&quot;</span>
<span class="n">REMOTE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;REMOTE&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="s2">&quot;../../../data/raw/GitHub/PullRequest.json.gz&quot;</span>
<span class="n">OUTPUT_DATA_PATH</span> <span class="o">=</span> <span class="s2">&quot;../../../data/processed/github&quot;</span>

<span class="k">if</span> <span class="n">REMOTE</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getting dataset from ceph&quot;</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span>
        <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
        <span class="n">endpoint_url</span><span class="o">=</span><span class="n">s3_endpoint_url</span><span class="p">,</span>
        <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">s3_access_key</span><span class="p">,</span>
        <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">s3_secret_key</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="n">s3_bucket</span><span class="p">,</span> <span class="s2">&quot;thoth/mi/openshift/origin/PullRequest.json&quot;</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">get</span><span class="p">()[</span><span class="s2">&quot;Body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
    <span class="n">prs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
        <span class="n">out_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">prs</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getting dataset from local&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">prs</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

<span class="n">pr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">prs</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>getting dataset from ceph
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17183, 15)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>interactions</th>
      <th>reviews</th>
      <th>labels</th>
      <th>commits</th>
      <th>changed_files</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26100</th>
      <td>bug 1949306: add e2e test to block usage of re...</td>
      <td>Right now this is set to flake in CI and provi...</td>
      <td>XXL</td>
      <td>deads2k</td>
      <td>1619104429</td>
      <td>1619253940</td>
      <td>openshift-merge-robot</td>
      <td>1619253940</td>
      <td>2</td>
      <td>135</td>
      <td>{'deads2k': 1, 'openshift-ci-robot': 307, 'stt...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-urgent, bugzilla/...</td>
      <td>[13b0e99d5f35d85998af9f07eb0c5b7d6fcc0dd0, 0c3...</td>
      <td>[go.mod, go.sum, test/extended/apiserver/api_r...</td>
    </tr>
    <tr>
      <th>26099</th>
      <td>bug 1951705: allow HighOverallControlPlaneCPU ...</td>
      <td>adding the alert in https://github.com/openshi...</td>
      <td>XS</td>
      <td>deads2k</td>
      <td>1619091511</td>
      <td>1619113470</td>
      <td>openshift-merge-robot</td>
      <td>1619113470</td>
      <td>1</td>
      <td>1</td>
      <td>{'openshift-ci-robot': 508, 'deads2k': 43, 'op...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-high, bugzilla/va...</td>
      <td>[7bc10c83eea29010f3b735c41847d43a992f606c]</td>
      <td>[test/extended/prometheus/prometheus.go]</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="inspect-the-dataset">
<h2>Inspect the dataset<a class="headerlink" href="#inspect-the-dataset" title="Permalink to this headline">¶</a></h2>
<p>Let’s unroll a single row and see what kind of information we have access to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span> <span class="o">=</span> <span class="n">pr_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">pr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>title                                   Bug 1949050: fix images.sh script
body                    This is a followup to https://github.com/opens...
size                                                                    S
created_by                                                        soltysh
created_at                                                     1618993979
closed_at                                                      1619069721
closed_by                                           openshift-merge-robot
merged_at                                                      1619069721
commits_number                                                          1
changed_files_number                                                    2
interactions            {&#39;openshift-ci-robot&#39;: 279, &#39;soltysh&#39;: 2, &#39;ope...
reviews                 {&#39;641526396&#39;: {&#39;author&#39;: &#39;adambkaplan&#39;, &#39;words...
labels                  [approved, bugzilla/severity-high, bugzilla/va...
commits                        [06830a927241a44ae24e9a4b5b2ac75f666d36bc]
changed_files           [test/extended/testdata/bindata.go, test/exten...
Name: 26096, dtype: object
</pre></div>
</div>
</div>
</div>
</br>
<div class="section" id="available-fields">
<h3><strong>Available Fields</strong><a class="headerlink" href="#available-fields" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>title</strong>: text providing a short description of the of the PR.</p></li>
<li><p><strong>body</strong>: text providing additional details regarding the changes.</p></li>
<li><p><strong>size</strong>: categorical label generated by GitHub summerizing the size of the changes made to the code base.</p></li>
<li><p><strong>created/closed/merged_at</strong>: timestamps for when the PR was opened, merged and finally closed.</p></li>
<li><p><strong>created/closed_by</strong>: usernames for contributors who created the PR and closed it.</p></li>
<li><p><strong>commits_number</strong>: integer indicating the number of commits in the PR.</p></li>
<li><p><strong>changed_files_number</strong>: integer indicating the number of files changed.</p></li>
</ul>
<p>The remaining fields appear to be collections of items, let’s unroll each one and see what additional information they provide.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span><span class="p">[</span><span class="s2">&quot;interactions&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;openshift-ci-robot&#39;: 279,
 &#39;soltysh&#39;: 2,
 &#39;openshift-bot&#39;: 180,
 &#39;openshift-ci[bot]&#39;: 79}
</pre></div>
</div>
</div>
</div>
<p><strong>interactions</strong>: a dictionary with usernames for keys and the number of times they interacted with the PR as the value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span><span class="p">[</span><span class="s2">&quot;reviews&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;641526396&#39;: {&#39;author&#39;: &#39;adambkaplan&#39;,
  &#39;words_count&#39;: 1,
  &#39;submitted_at&#39;: 1619032331,
  &#39;state&#39;: &#39;APPROVED&#39;}}
</pre></div>
</div>
</div>
</div>
<p><strong>reviews</strong>: a dictionary of reviews that includes an id number key along with fields for author, word_count, submitted timestamp and state of review.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;approved&#39;, &#39;bugzilla/severity-high&#39;, &#39;bugzilla/valid-bug&#39;, &#39;lgtm&#39;]
</pre></div>
</div>
</div>
</div>
<p><strong>labels</strong>: a list of labels tagged to the PR describing some of its attributes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr</span><span class="p">[</span><span class="s2">&quot;commits&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;06830a927241a44ae24e9a4b5b2ac75f666d36bc&#39;]
</pre></div>
</div>
</div>
</div>
<p><strong>commits</strong>: a list of commit hashes that point to specific changes made to the repo’s history</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pr</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]))</span>
<span class="n">pr</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;test/extended/testdata/bindata.go&#39;,
 &#39;test/extended/testdata/cmd/test/cmd/images.sh&#39;]
</pre></div>
</div>
</div>
</div>
<p><strong>changed_files</strong>: a list of the paths and filenames for every file changed by this PR.</p>
<p>We now know what we have access to in this dataset. It is a collection of numerical, categorical and textual features used to describe a PR. This gives us a lot of potential avenues to explore from an EDA and Data Science perspective. But is also creates an additional challenge insofar as we’ll need to do a bit of feature engineering to get this data into format that is ready to be ingested by any ML models.</p>
</div>
</div>
<div class="section" id="feature-engineering">
<h2>Feature engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline">¶</a></h2>
<p>In the next section we will do some basic feature engineering and correlation analyis on our dataset to see if anything interesting jumps out at us.</p>
<p><strong>Time to Merge</strong></p>
<p>We will derive a new feature called <code class="docutils literal notranslate"><span class="pre">time_to_merge</span></code> which will be the difference between the <code class="docutils literal notranslate"><span class="pre">created_at</span></code> and <code class="docutils literal notranslate"><span class="pre">merged_at</span></code> fields.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># derive time_to_merege</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;merged_at&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at&quot;</span><span class="p">]</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>
<span class="c1"># NOTE: we cant fill NA with 0 because that would imply the PR got merged instantaneously</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s look at the distribution of the time to merge column. This can help us determine what the setup for ML problems such as <a class="reference external" href="https://github.com/aicoe-aiops/ocp-ci-analysis/issues/236">#236</a> could be like. That is, should the time to merge problem be framed as a regression or classification problem.</p>
<p>First, lets try to determine what the granularity of the output values should be, in case of a regression setup. That is, should the model predict time to merge in number of seconds, number of hours, number of days, or some other chunk of time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># what does the distribution of values look like if we choose days as the granularity</span>
<span class="n">ttm_days</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pr_df</span><span class="o">.</span><span class="n">time_to_merge</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">))</span>

<span class="c1"># value counts - to how many PRs have value 1, 2, 3, etc. for days to merge</span>
<span class="n">vc</span> <span class="o">=</span> <span class="n">ttm_days</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="c1"># normalized value counts (i.e. percent of PRs instead of raw number)</span>
<span class="n">nvc</span> <span class="o">=</span> <span class="n">vc</span> <span class="o">/</span> <span class="n">vc</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">nvc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0      0.398226
2.0      0.145972
3.0      0.075166
4.0      0.050924
5.0      0.041463
           ...   
150.0    0.000074
237.0    0.000074
197.0    0.000074
167.0    0.000074
170.0    0.000074
Name: time_to_merge, Length: 186, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># only plot top 100 values so that graph is legible</span>
<span class="n">nvc</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Days&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of PRs per Day&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_27_0.png" src="../../../_images/github_PR_EDA_27_0.png" />
</div>
</div>
<p>From the above graph we can see that if we bucket the data into days, then roughly 40% of the data points would have the value “1”, 15% would have the value “2” and so on. Therefore we need to select a finer granularity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># what if we chose some intermediate value e.g. 3 hours as the granularity?</span>
<span class="n">ttm_3hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pr_df</span><span class="o">.</span><span class="n">time_to_merge</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># value counts - to how many PRs have value 1, 2, 3, etc. for num. 3-hours to merge</span>
<span class="n">vc</span> <span class="o">=</span> <span class="n">ttm_3hours</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="c1"># normalized value counts (i.e. percent of PRs instead of raw number)</span>
<span class="n">nvc</span> <span class="o">=</span> <span class="n">vc</span> <span class="o">/</span> <span class="n">vc</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">nvc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0      0.098670
2.0      0.080414
3.0      0.054619
4.0      0.038655
8.0      0.034812
           ...   
580.0    0.000074
489.0    0.000074
566.0    0.000074
345.0    0.000074
971.0    0.000074
Name: time_to_merge, Length: 691, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># only plot top 100 values so that graph is legible</span>
<span class="n">nvc</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;3 Hour Intervals&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of PRs per 3 Hour Interval&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_30_0.png" src="../../../_images/github_PR_EDA_30_0.png" />
</div>
</div>
<p>From the above outputs we can see that if we bucket the data into 3 hours, then roughly 10% of the data points would have the value “1”, 10% would have the value “2”, 5% would have the value 3, and so on. This is a slightly better value distribution than before, but could be made even better. Lets explore what this would look like with an “hours” granularity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># what if we chose hours as the granularity?</span>
<span class="n">ttm_hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">pr_df</span><span class="o">.</span><span class="n">time_to_merge</span> <span class="o">/</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">))</span>

<span class="c1"># value counts - to how many PRs have value 1, 2, 3, etc. for hours to merge</span>
<span class="n">vc</span> <span class="o">=</span> <span class="n">ttm_hours</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>

<span class="c1"># normalized value counts (i.e. percent of PRs instead of raw number)</span>
<span class="n">nvc</span> <span class="o">=</span> <span class="n">vc</span> <span class="o">/</span> <span class="n">vc</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">nvc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.0       0.034368
2.0       0.034368
4.0       0.030007
1.0       0.029933
5.0       0.026829
            ...   
827.0     0.000074
812.0     0.000074
733.0     0.000074
1714.0    0.000074
1854.0    0.000074
Name: time_to_merge, Length: 1314, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># only plot top 100 values so that graph is legible</span>
<span class="n">nvc</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Hours&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of PRs per Hour&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_33_0.png" src="../../../_images/github_PR_EDA_33_0.png" />
</div>
</div>
<p>From the above outputs we can see that if we bucket the data into hours, then roughly 3% of the data points would have the value “2”, 3% would have the value “3”, 3% would have the value “4”, and so on. This seems like a reasonable distribution of values for a regression problem, since the data does not get skewed towards any one particular value.</p>
<p>As we make it more granular (e.g. minutes), the distribution would get even more uniform. However, a granularity finer than 1 hour might not provide any additional value to the end user. So we will go with granularity of 1 hour for our regression setup.</p>
<p>Now, lets try to determine, if we were to set this up as a classification problem, what the output classes should be. In the following cell, we’ll try to split the time-to-merge values into 10 equally populated buckets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lets look at what the 10th, 20th, 30th etc percentiles are, to see what the bin boundaries (in terms of hours)</span>
<span class="c1"># would be if we were to split the data in 10 equally populated bins</span>
<span class="n">n_buckets</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">quantiles</span> <span class="o">=</span> <span class="n">pr_df</span><span class="o">.</span><span class="n">time_to_merge</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">1e-100</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">n_buckets</span><span class="p">))</span>
<span class="n">quantiles</span> <span class="o">/</span> <span class="mi">3600</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0      0.000833
0.1      3.055000
0.2      7.060056
0.3     14.783722
0.4     24.154278
0.5     36.940833
0.6     65.870667
0.7    112.790861
0.8    191.135000
0.9    462.285278
Name: time_to_merge, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># gaps between the buckets (i.e. size of each bucket) in hours</span>
<span class="p">(</span><span class="n">quantiles</span> <span class="o">-</span> <span class="n">quantiles</span><span class="o">.</span><span class="n">shift</span><span class="p">())</span> <span class="o">/</span> <span class="mi">3600</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0           NaN
0.1      3.054167
0.2      4.005056
0.3      7.723667
0.4      9.370556
0.5     12.786556
0.6     28.929833
0.7     46.920194
0.8     78.344139
0.9    271.150278
Name: time_to_merge, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>If we want to frame our ML problem as a classification problem, we can use the above buckets to define the classes. That is, class 0 is “merged within 3 hours”, class 1 is “merged within 3-7 hours”, etc.</p>
<p>Based on the EDA so far, we cannot conclusively reject either classification or regression. We can explore both of these approaches in depth in forthcoming notebooks and re-evaluate the best setup for this problem.</p>
<p><strong>Body</strong></p>
<p>Here, we will derive a feature called <code class="docutils literal notranslate"><span class="pre">body_size</span></code> which will simply be the number of words in the body of the PR. We can use this numerical value to describe the body of the PR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># derive body_size</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;body_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># derive body_size</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;body_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;body&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>interactions</th>
      <th>reviews</th>
      <th>labels</th>
      <th>commits</th>
      <th>changed_files</th>
      <th>time_to_merge</th>
      <th>body_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26100</th>
      <td>bug 1949306: add e2e test to block usage of re...</td>
      <td>Right now this is set to flake in CI and provi...</td>
      <td>XXL</td>
      <td>deads2k</td>
      <td>1619104429</td>
      <td>1619253940</td>
      <td>openshift-merge-robot</td>
      <td>1619253940</td>
      <td>2</td>
      <td>135</td>
      <td>{'deads2k': 1, 'openshift-ci-robot': 307, 'stt...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-urgent, bugzilla/...</td>
      <td>[13b0e99d5f35d85998af9f07eb0c5b7d6fcc0dd0, 0c3...</td>
      <td>[go.mod, go.sum, test/extended/apiserver/api_r...</td>
      <td>149511.0</td>
      <td>37</td>
    </tr>
    <tr>
      <th>26099</th>
      <td>bug 1951705: allow HighOverallControlPlaneCPU ...</td>
      <td>adding the alert in https://github.com/openshi...</td>
      <td>XS</td>
      <td>deads2k</td>
      <td>1619091511</td>
      <td>1619113470</td>
      <td>openshift-merge-robot</td>
      <td>1619113470</td>
      <td>1</td>
      <td>1</td>
      <td>{'openshift-ci-robot': 508, 'deads2k': 43, 'op...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-high, bugzilla/va...</td>
      <td>[7bc10c83eea29010f3b735c41847d43a992f606c]</td>
      <td>[test/extended/prometheus/prometheus.go]</td>
      <td>21959.0</td>
      <td>30</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Size</strong></p>
<p>We can attempt to convert the categorical size label generated by GitHub, which summerizes the size of the changes made to the code base, to a numerical value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">convert_size</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;XS&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;XL&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;XXL&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}}</span>
<span class="n">pr_df</span> <span class="o">=</span> <span class="n">pr_df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">convert_size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Title</strong></p>
<p>Lets try to see if the PR title text can be used to extract any useful information regarding the PR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># first lets preprocess the text available in the titles</span>

<span class="c1"># convert to lowercase</span>
<span class="n">preproc_titles</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

<span class="c1"># remove punctuations and symbols like : ; , # ( ) [ ] etc</span>
<span class="n">preproc_titles</span> <span class="o">=</span> <span class="n">preproc_titles</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[`#-.?!,:;\/()\[\]&quot;</span><span class="se">\&#39;</span><span class="s1">]&#39;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># remove hash-like strings i.e. 25+ char long strings containing 0-9 or a-f</span>
<span class="n">preproc_titles</span> <span class="o">=</span> <span class="n">preproc_titles</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[0-9a-f]{25,}&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">preproc_titles</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26100    bug 1949306  add e2e test to block usage of re...
26099    bug 1951705  allow highoverallcontrolplanecpu ...
26098    refactor testmultipleimagechangebuildtriggers ...
26097    wip  monitor  move  crashlooping pods  test to...
26096                    bug 1949050  fix images sh script
                               ...                        
5                            add examples for pod creation
4                  wip  added project template json schema
3                        added etcd folder into  gitignore
2                              add alpha api documentation
1                    add link to gopath doc and fixup typo
Name: title, Length: 17183, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># what are the most commonly appearing words in the titles</span>

<span class="c1"># combin all titles and split into words</span>
<span class="n">words</span> <span class="o">=</span> <span class="n">preproc_titles</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">sep</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="c1"># remove stopwords and numbers (e.g. bugzilla ids)</span>
<span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">w</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">STOPWORDS</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">w</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">()]</span>

<span class="c1"># word frequencies</span>
<span class="n">unique_words</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">vc</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">unique_words</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># plot the 20 most common words</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">20</span><span class="p">],</span>
    <span class="n">y</span><span class="o">=</span><span class="n">vc</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">20</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Top word frequencies in the PR Titles&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;words&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_48_0.png" src="../../../_images/github_PR_EDA_48_0.png" />
</div>
</div>
<p>From the above graph, we can see that titles often contain some keywords that can hint towards the type of changes being made in the PR. We will create a feature which is a vector indicating how many times each word appeared in the title. This way, even if a less prominent word is more correlated with time_to_merge, we will be able to capture that relationship.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add word count columns</span>
<span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">unique_words</span><span class="p">):</span>
    <span class="n">pr_df</span><span class="p">[</span><span class="n">f</span><span class="s2">&quot;title_wordcount_</span><span class="si">{word}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preproc_titles</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  1%|█▎                                                                                                    | 96/7828 [00:01&lt;01:43, 74.51it/s]/tmp/ipykernel_130991/4191214648.py:3: PerformanceWarning: DataFrame is highly fragmented.  This is usually the result of calling `frame.insert` many times, which has poor performance.  Consider using pd.concat instead.  To get a de-fragmented frame, use `newframe = frame.copy()`
  pr_df[f&quot;title_wordcount_{word}&quot;] = preproc_titles.apply(
100%|████████████████████████████████████████████████████████████████████████████████████████████████████| 7828/7828 [01:53&lt;00:00, 68.96it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># collapse the high dim vector into one column</span>
<span class="n">wordcount_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">pr_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s2">&quot;wordcount&quot;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;title_word_counts_vec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="n">wordcount_columns</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># drop the individual wordcount columns</span>
<span class="n">pr_df</span> <span class="o">=</span> <span class="n">pr_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">wordcount_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>interactions</th>
      <th>reviews</th>
      <th>labels</th>
      <th>commits</th>
      <th>changed_files</th>
      <th>time_to_merge</th>
      <th>body_size</th>
      <th>title_word_counts_vec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26100</th>
      <td>bug 1949306: add e2e test to block usage of re...</td>
      <td>Right now this is set to flake in CI and provi...</td>
      <td>5</td>
      <td>deads2k</td>
      <td>1619104429</td>
      <td>1619253940</td>
      <td>openshift-merge-robot</td>
      <td>1619253940</td>
      <td>2</td>
      <td>135</td>
      <td>{'deads2k': 1, 'openshift-ci-robot': 307, 'stt...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-urgent, bugzilla/...</td>
      <td>[13b0e99d5f35d85998af9f07eb0c5b7d6fcc0dd0, 0c3...</td>
      <td>[go.mod, go.sum, test/extended/apiserver/api_r...</td>
      <td>149511.0</td>
      <td>37</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>26099</th>
      <td>bug 1951705: allow HighOverallControlPlaneCPU ...</td>
      <td>adding the alert in https://github.com/openshi...</td>
      <td>0</td>
      <td>deads2k</td>
      <td>1619091511</td>
      <td>1619113470</td>
      <td>openshift-merge-robot</td>
      <td>1619113470</td>
      <td>1</td>
      <td>1</td>
      <td>{'openshift-ci-robot': 508, 'deads2k': 43, 'op...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-high, bugzilla/va...</td>
      <td>[7bc10c83eea29010f3b735c41847d43a992f606c]</td>
      <td>[test/extended/prometheus/prometheus.go]</td>
      <td>21959.0</td>
      <td>30</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Created By</strong></p>
<p>Is the time taken to merge a PR affected by the author of the PR? E.g. if a code reviewer or someone who has already made several contributions to a repo creates a PR, is it likely to get merged relatively faster?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># approvers and reviewers list from the repo</span>
<span class="n">approvers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;bparees&quot;</span><span class="p">,</span>
    <span class="s2">&quot;deads2k&quot;</span><span class="p">,</span>
    <span class="s2">&quot;derekwaynecarr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;eparis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;knobunc&quot;</span><span class="p">,</span>  <span class="c1"># Network, Multi-cluster, Storage</span>
    <span class="s2">&quot;mfojtik&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pweil-&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sjenning&quot;</span><span class="p">,</span>
    <span class="s2">&quot;soltysh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sttts&quot;</span><span class="p">,</span>
    <span class="s2">&quot;smarterclayton&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">reviewers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;bparees&quot;</span><span class="p">,</span>
    <span class="s2">&quot;deads2k&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sjenning&quot;</span><span class="p">,</span>
    <span class="s2">&quot;smarterclayton&quot;</span><span class="p">,</span>
    <span class="s2">&quot;soltysh&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># is the pr creator on the approvers or reviewers list</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;is_reviewer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_by&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">reviewers</span><span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;is_approver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_by&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">approvers</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>interactions</th>
      <th>reviews</th>
      <th>labels</th>
      <th>commits</th>
      <th>changed_files</th>
      <th>time_to_merge</th>
      <th>body_size</th>
      <th>title_word_counts_vec</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>26100</th>
      <td>bug 1949306: add e2e test to block usage of re...</td>
      <td>Right now this is set to flake in CI and provi...</td>
      <td>5</td>
      <td>deads2k</td>
      <td>1619104429</td>
      <td>1619253940</td>
      <td>openshift-merge-robot</td>
      <td>1619253940</td>
      <td>2</td>
      <td>135</td>
      <td>{'deads2k': 1, 'openshift-ci-robot': 307, 'stt...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-urgent, bugzilla/...</td>
      <td>[13b0e99d5f35d85998af9f07eb0c5b7d6fcc0dd0, 0c3...</td>
      <td>[go.mod, go.sum, test/extended/apiserver/api_r...</td>
      <td>149511.0</td>
      <td>37</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>26099</th>
      <td>bug 1951705: allow HighOverallControlPlaneCPU ...</td>
      <td>adding the alert in https://github.com/openshi...</td>
      <td>0</td>
      <td>deads2k</td>
      <td>1619091511</td>
      <td>1619113470</td>
      <td>openshift-merge-robot</td>
      <td>1619113470</td>
      <td>1</td>
      <td>1</td>
      <td>{'openshift-ci-robot': 508, 'deads2k': 43, 'op...</td>
      <td>{}</td>
      <td>[approved, bugzilla/severity-high, bugzilla/va...</td>
      <td>[7bc10c83eea29010f3b735c41847d43a992f606c]</td>
      <td>[test/extended/prometheus/prometheus.go]</td>
      <td>21959.0</td>
      <td>30</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>True</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We also want to derive a feature called <code class="docutils literal notranslate"><span class="pre">num_prev_merged_prs</span></code> captures the number of PRs that the creator created before this PR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># how many prs did the creator create before this pr</span>
<span class="k">def</span> <span class="nf">get_prev_pr_info</span><span class="p">(</span><span class="n">creator_pr_df</span><span class="p">):</span>
    <span class="n">num_prev_merged_prs</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">creator_pr_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">expanding</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">num_prev_merged_prs</span>


<span class="c1"># need to sort before applying groupby</span>
<span class="c1"># because merging is not possible as df index types are different</span>
<span class="n">pr_df</span> <span class="o">=</span> <span class="n">pr_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;created_at&quot;</span><span class="p">)</span>

<span class="n">num_prev_merged_prs</span> <span class="o">=</span> <span class="n">pr_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;created_by&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_prev_pr_info</span><span class="p">)</span>
<span class="n">num_prev_merged_prs</span> <span class="o">=</span> <span class="n">num_prev_merged_prs</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;num_prev_prs&quot;</span><span class="p">)</span>

<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;num_prev_merged_prs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_prev_merged_prs</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>...</th>
      <th>reviews</th>
      <th>labels</th>
      <th>commits</th>
      <th>changed_files</th>
      <th>time_to_merge</th>
      <th>body_size</th>
      <th>title_word_counts_vec</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>num_prev_merged_prs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Add link to GOPATH doc and fixup typo</td>
      <td>None</td>
      <td>0</td>
      <td>jwforres</td>
      <td>1407759383</td>
      <td>1407759502</td>
      <td>smarterclayton</td>
      <td>1407759502</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>{}</td>
      <td>[]</td>
      <td>[3c15fd6dd7cee58393feb786fd7876b6f22fe9b5]</td>
      <td>[README.md]</td>
      <td>119.0</td>
      <td>0</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Add alpha API documentation</td>
      <td>Merge of csrwng/oo-api-v3\n</td>
      <td>5</td>
      <td>csrwng</td>
      <td>1407834992</td>
      <td>1407844533</td>
      <td>danmcp</td>
      <td>1407844533</td>
      <td>1</td>
      <td>54</td>
      <td>...</td>
      <td>{}</td>
      <td>[]</td>
      <td>[24acb7993293e311e8c1f76f4b17791998c2f391]</td>
      <td>[api/README.md, api/build_flow.odg, api/doc/co...</td>
      <td>9541.0</td>
      <td>3</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 21 columns</p>
</div></div></div>
</div>
<p><strong>Created At</strong></p>
<p>This column can give us information on when the PR was created. Using the <code class="docutils literal notranslate"><span class="pre">created_at</span></code> field, we can derive other features like <code class="docutils literal notranslate"><span class="pre">time_of_day</span></code>, <code class="docutils literal notranslate"><span class="pre">day_of_week</span></code>, <code class="docutils literal notranslate"><span class="pre">day_of_month</span></code>, <code class="docutils literal notranslate"><span class="pre">month_in_year</span></code> each of which can be categorical features that can be useful to our analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert to datetime object</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_datetime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="p">)</span>
<span class="c1"># get day as categorical variable</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_day&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>

<span class="c1"># get month as categorical variable</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>

<span class="c1"># get weekday as categorical variable</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_weekday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span>

<span class="c1"># get hour of day as categorical variable</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;created_at_datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>...</th>
      <th>body_size</th>
      <th>title_word_counts_vec</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>num_prev_merged_prs</th>
      <th>created_at_datetime</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>created_at_hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Add link to GOPATH doc and fixup typo</td>
      <td>None</td>
      <td>0</td>
      <td>jwforres</td>
      <td>1407759383</td>
      <td>1407759502</td>
      <td>smarterclayton</td>
      <td>1407759502</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>2014-08-11 08:16:23</td>
      <td>11</td>
      <td>8</td>
      <td>0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Add alpha API documentation</td>
      <td>Merge of csrwng/oo-api-v3\n</td>
      <td>5</td>
      <td>csrwng</td>
      <td>1407834992</td>
      <td>1407844533</td>
      <td>danmcp</td>
      <td>1407844533</td>
      <td>1</td>
      <td>54</td>
      <td>...</td>
      <td>3</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>2014-08-12 05:16:32</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 26 columns</p>
</div></div></div>
</div>
<p><strong>Commits Number</strong><br />
Commits Number gives the number of commits created within the PR. This could be a numerical feature for our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">commits_number</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1      13304
2       1986
3        737
4        353
5        234
       ...  
28         1
31         1
83         1
350        1
561        1
Name: commits_number, Length: 105, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">commits_number</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Commit frequency across PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;No. of commits&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;No. of PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_65_0.png" src="../../../_images/github_PR_EDA_65_0.png" />
</div>
</div>
<p>As we see above, in this dataset, there is not much variability in the commits number. Majority of the PRs (77%) have 1 commit, 11% have 2 commits and rest(12%) have more than 2 commits. We can break commits number down into 3 categorical variables, <code class="docutils literal notranslate"><span class="pre">contains_1_commit</span></code>, <code class="docutils literal notranslate"><span class="pre">contains_2_commits</span></code>, <code class="docutils literal notranslate"><span class="pre">contains_3_or_more_commits</span></code>. However, there might be some value in knowing whether a PR had 5 commits vs. 10 commits. So we will treat it as a numerical variable to begin with.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>...</th>
      <th>body_size</th>
      <th>title_word_counts_vec</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>num_prev_merged_prs</th>
      <th>created_at_datetime</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>created_at_hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Add link to GOPATH doc and fixup typo</td>
      <td>None</td>
      <td>0</td>
      <td>jwforres</td>
      <td>1407759383</td>
      <td>1407759502</td>
      <td>smarterclayton</td>
      <td>1407759502</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>2014-08-11 08:16:23</td>
      <td>11</td>
      <td>8</td>
      <td>0</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Add alpha API documentation</td>
      <td>Merge of csrwng/oo-api-v3\n</td>
      <td>5</td>
      <td>csrwng</td>
      <td>1407834992</td>
      <td>1407844533</td>
      <td>danmcp</td>
      <td>1407844533</td>
      <td>1</td>
      <td>54</td>
      <td>...</td>
      <td>3</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>2014-08-12 05:16:32</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 26 columns</p>
</div></div></div>
</div>
<p><strong>Changed Files Number</strong><br />
Changed files is a numberical variable which captures the numer of files that were modified in the PR.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert changed_files_number to int</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files_number&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files_number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span>

<span class="n">pr_df</span><span class="o">.</span><span class="n">changed_files_number</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1        6151
2        3046
3        1622
4        1035
5         669
         ... 
409         1
11489       1
7556        1
8786        1
135         1
Name: changed_files_number, Length: 422, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">changed_files_number</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Frequency of changed files across PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;No. of changed files&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;No. of PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_70_0.png" src="../../../_images/github_PR_EDA_70_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">changed_files_number</span></code> has more variability than the <code class="docutils literal notranslate"><span class="pre">commits_number</span></code>. We can incorporate this as a numerical feature.</p>
<p><strong>Changed_files</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">changed_files</span></code> is a list of the paths and filenames for every file changed by this PR. From <code class="docutils literal notranslate"><span class="pre">changed_files</span></code>, we know, for each PR, which file types were changed which can be encoded as a frequency vector. Also we know which directory the change is made in, so that can be encoded as a categorical variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">changed_files</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;pkg/template/example/project.json&#39;,
 &#39;pkg/template/generator.go&#39;,
 &#39;pkg/template/generator/from_url.go&#39;,
 &#39;pkg/template/generator/generator.go&#39;,
 &#39;pkg/template/generator/template.go&#39;,
 &#39;pkg/template/generator_test.go&#39;,
 &#39;pkg/template/service_links.go&#39;,
 &#39;pkg/template/service_links_test.go&#39;,
 &#39;pkg/template/types.go&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">filetype</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>

    <span class="c1"># if standard file extension, return file extension</span>
    <span class="k">if</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># if single file at the root of repo</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
            <span class="c1"># if a file like README/Dockerfile etc</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">filepath</span>
        <span class="c1"># if file not at root</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># get file name</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">file</span>
            <span class="k">elif</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
                <span class="k">return</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get list of all file types that were modified across all openshift origin PRs</span>
<span class="n">changed_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_changed_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">filetype</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">for</span> <span class="n">pr</span> <span class="ow">in</span> <span class="n">changed_files</span> <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">pr</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">all_changed_files</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># save 100 most commonly occuring file extensions across PRs</span>
<span class="n">top_fileextensions_freq</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="n">top_fileextensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">ext</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">top_fileextensions_freq</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">top_fileextensions</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;.go&#39;,
 &#39;.json&#39;,
 &#39;.1&#39;,
 &#39;.sh&#39;,
 &#39;.md&#39;,
 &#39;.yaml&#39;,
 &#39;BUILD&#39;,
 &#39;.proto&#39;,
 &#39;.yml&#39;,
 &#39;OWNERS&#39;,
 &#39;.html&#39;,
 &#39;.adoc&#39;,
 &#39;Dockerfile&#39;,
 &#39;.js&#39;,
 &#39;LICENSE&#39;,
 &#39;Makefile&#39;,
 &#39;.txt&#39;,
 &#39;.gitignore&#39;,
 &#39;oc&#39;,
 &#39;.pem&#39;,
 &#39;.s&#39;,
 &#39;.mod&#39;,
 &#39;openshift&#39;,
 &#39;.lock&#39;,
 &#39;.py&#39;,
 &#39;.sum&#39;,
 &#39;.conf&#39;,
 &#39;.bats&#39;,
 &#39;.png&#39;,
 &#39;.less&#39;,
 &#39;.pb&#39;,
 &#39;.feature&#39;,
 &#39;.xml&#39;,
 &#39;.tar&#39;,
 &#39;.crt&#39;,
 &#39;.spec&#39;,
 &#39;.template&#39;,
 &#39;AUTHORS&#39;,
 &#39;.service&#39;,
 &#39;.key&#39;,
 &#39;run&#39;,
 &#39;.mk&#39;,
 &#39;.scss&#39;,
 &#39;.golden&#39;,
 &#39;oadm&#39;,
 &#39;.rhel&#39;,
 &#39;.cert&#39;,
 &#39;result&#39;,
 &#39;.original&#39;,
 &#39;.h&#39;,
 &#39;.toml&#39;,
 &#39;.dat&#39;,
 &#39;.edited&#39;,
 &#39;MAINTAINERS&#39;,
 &#39;.svg&#39;,
 &#39;.in&#39;,
 &#39;.text&#39;,
 &#39;README&#39;,
 &#39;.cfg&#39;,
 &#39;.cc&#39;,
 &#39;NOTICE&#39;,
 &#39;.c&#39;,
 &#39;.bash&#39;,
 &#39;.pl&#39;,
 &#39;Vagrantfile&#39;,
 &#39;.chain&#39;,
 &#39;.centos7&#39;,
 &#39;CONTRIBUTORS&#39;,
 &#39;.gz&#39;,
 &#39;cert&#39;,
 &#39;key&#39;,
 &#39;.swift&#39;,
 &#39;.csr&#39;,
 &#39;.files_generated_oc&#39;,
 &#39;.sc&#39;,
 &#39;Readme&#39;,
 &#39;.tmpl&#39;,
 &#39;.empty&#39;,
 &#39;.insecure&#39;,
 &#39;.hcl&#39;,
 &#39;PATENTS&#39;,
 &#39;.files_generated_openshift&#39;,
 &#39;.sec&#39;,
 None,
 &#39;VERSION&#39;,
 &#39;.css&#39;,
 &#39;.ini&#39;,
 &#39;Procfile&#39;,
 &#39;.ber&#39;,
 &#39;.env&#39;,
 &#39;.sls&#39;,
 &#39;.mailmap&#39;,
 &#39;.markdown&#39;,
 &#39;test&#39;,
 &#39;.com&#39;,
 &#39;.sysconfig&#39;,
 &#39;.yaml-merge-patch&#39;,
 &#39;.gitattributes&#39;,
 &#39;.java&#39;,
 &#39;.signature&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">file_type_freq</span><span class="p">(</span><span class="n">list_of_filepaths</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For a given PR&#39;s list of changed files,</span>
<span class="sd">    return a changed files frequency vector</span>
<span class="sd">    ( a vector which holds the frequency of</span>
<span class="sd">    changed files of the type  for every</span>
<span class="sd">    file type in top_fileextensions )</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">file_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="n">filetype</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">list_of_filepaths</span><span class="p">]</span>
    <span class="n">ext_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">top_fileextensions</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">file_extensions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ext_dict</span><span class="p">:</span>
            <span class="n">ext_dict</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">ext_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_file_type_vec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">file_type_freq</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>...</th>
      <th>title_word_counts_vec</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>num_prev_merged_prs</th>
      <th>created_at_datetime</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>created_at_hour</th>
      <th>changed_file_type_vec</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Add link to GOPATH doc and fixup typo</td>
      <td>None</td>
      <td>0</td>
      <td>jwforres</td>
      <td>1407759383</td>
      <td>1407759502</td>
      <td>smarterclayton</td>
      <td>1407759502</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>2014-08-11 08:16:23</td>
      <td>11</td>
      <td>8</td>
      <td>0</td>
      <td>8</td>
      <td>[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Add alpha API documentation</td>
      <td>Merge of csrwng/oo-api-v3\n</td>
      <td>5</td>
      <td>csrwng</td>
      <td>1407834992</td>
      <td>1407844533</td>
      <td>danmcp</td>
      <td>1407844533</td>
      <td>1</td>
      <td>54</td>
      <td>...</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>2014-08-12 05:16:32</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
      <td>[0, 47, 0, 0, 4, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0,...</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 27 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We will also create a categorical variable for a modification in</span>
<span class="c1"># each of the directories present in the openshift origins repo</span>

<span class="n">directories</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;.github&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cmd&quot;</span><span class="p">,</span>
    <span class="s2">&quot;docs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;e2echart&quot;</span><span class="p">,</span>
    <span class="s2">&quot;examples&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hack&quot;</span><span class="p">,</span>
    <span class="s2">&quot;images&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pkg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;test&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tools&quot;</span><span class="p">,</span>
    <span class="s2">&quot;vendor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;root&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">directory_from_filepath</span><span class="p">(</span><span class="n">list_of_filepaths</span><span class="p">):</span>

    <span class="n">directories</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">filepath</span> <span class="ow">in</span> <span class="n">list_of_filepaths</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">filepath</span><span class="p">:</span>
            <span class="n">directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filepath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">directories</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># does the PR make a change to the given directory</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_.github&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;.github&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_cmd&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;cmd&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_docs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;docs&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_e2echart&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;e2echart&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_examples&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;examples&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_hack&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;hack&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_images&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;images&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_pkg&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;pkg&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_test&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;test&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_tools&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;tools&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_vendor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;vendor&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
<span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;change_in_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;root&quot;</span> <span class="ow">in</span> <span class="n">directory_from_filepath</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pr_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>body</th>
      <th>size</th>
      <th>created_by</th>
      <th>created_at</th>
      <th>closed_at</th>
      <th>closed_by</th>
      <th>merged_at</th>
      <th>commits_number</th>
      <th>changed_files_number</th>
      <th>...</th>
      <th>change_in_docs</th>
      <th>change_in_e2echart</th>
      <th>change_in_examples</th>
      <th>change_in_hack</th>
      <th>change_in_images</th>
      <th>change_in_pkg</th>
      <th>change_in_test</th>
      <th>change_in_tools</th>
      <th>change_in_vendor</th>
      <th>change_in_root</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Add link to GOPATH doc and fixup typo</td>
      <td>None</td>
      <td>0</td>
      <td>jwforres</td>
      <td>1407759383</td>
      <td>1407759502</td>
      <td>smarterclayton</td>
      <td>1407759502</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Add alpha API documentation</td>
      <td>Merge of csrwng/oo-api-v3\n</td>
      <td>5</td>
      <td>csrwng</td>
      <td>1407834992</td>
      <td>1407844533</td>
      <td>danmcp</td>
      <td>1407844533</td>
      <td>1</td>
      <td>54</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 39 columns</p>
</div></div></div>
</div>
<p>We can see above that some PRs have 0 for all directory fields since the directory structure of the repo has changed over time and we are interested in only the latest directory structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># subset DataFrame to use as features</span>
<span class="n">feature_df</span> <span class="o">=</span> <span class="n">pr_df</span><span class="p">[</span>
    <span class="p">[</span>
        <span class="s2">&quot;time_to_merge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;changed_files_number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;title_word_counts_vec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_reviewer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_approver&quot;</span><span class="p">,</span>
        <span class="s2">&quot;num_prev_merged_prs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_day&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_month&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_weekday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_hour&quot;</span><span class="p">,</span>
        <span class="s2">&quot;commits_number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;changed_file_type_vec&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_.github&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_cmd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_docs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_e2echart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_examples&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_hack&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_images&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_pkg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_test&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_tools&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_vendor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_root&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="add-pr-ttm-class-column">
<h3>Add PR TTM Class Column<a class="headerlink" href="#add-pr-ttm-class-column" title="Permalink to this headline">¶</a></h3>
<p>Lets split up the time to merge values into 10 discrete bins (as discussed above) to use as our prediction classes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_ttm_class</span><span class="p">(</span><span class="n">ttm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assign a ttm &quot;class&quot; / &quot;category&quot; / &quot;bin&quot; to the input numerical ttm value</span>
<span class="sd">    E.g. if the time to merge was 1.5 hours, this function will return</span>
<span class="sd">    class &quot;0&quot; which represents &quot;merged in 0-3 hours&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">5</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">112</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">6</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">190</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">7</span>
    <span class="k">elif</span> <span class="n">ttm</span> <span class="o">&lt;</span> <span class="mi">462</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">8</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">9</span>


<span class="n">feature_df</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">feature_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_ttm_class</span><span class="p">)</span>
<span class="n">feature_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/kachau/.local/share/virtualenvs/ocp-ci-analysis-XKK7qNs8/lib/python3.8/site-packages/pandas/core/frame.py:3607: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  self._set_item(key, value)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_to_merge</th>
      <th>changed_files_number</th>
      <th>body_size</th>
      <th>size</th>
      <th>title_word_counts_vec</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>num_prev_merged_prs</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>...</th>
      <th>change_in_e2echart</th>
      <th>change_in_examples</th>
      <th>change_in_hack</th>
      <th>change_in_images</th>
      <th>change_in_pkg</th>
      <th>change_in_test</th>
      <th>change_in_tools</th>
      <th>change_in_vendor</th>
      <th>change_in_root</th>
      <th>ttm_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>119.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>11</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9541.0</td>
      <td>54</td>
      <td>3</td>
      <td>5</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>12</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>30435.0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>True</td>
      <td>0.0</td>
      <td>12</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>True</td>
      <td>0.0</td>
      <td>12</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>9</td>
    </tr>
    <tr>
      <th>5</th>
      <td>20040.0</td>
      <td>7</td>
      <td>0</td>
      <td>2</td>
      <td>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...</td>
      <td>False</td>
      <td>False</td>
      <td>0.0</td>
      <td>12</td>
      <td>8</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 27 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize data points distribution across classes</span>
<span class="n">feature_df</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of PRs across TTM Labels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time to Merge Class&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of PRs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_91_0.png" src="../../../_images/github_PR_EDA_91_0.png" />
</div>
</div>
<p>From the above graph, we can see that data is fairly uniformly distributed across all classes. At the same time, the class definitions are also easily interpretable by human experts. So this seems like a good setup for our classification task.</p>
<p>Let’s look at some pair-wise scatter plots of our data to see if there are any obvious correlations between our features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="p">((</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">),</span> <span class="p">(</span><span class="n">ax4</span><span class="p">,</span> <span class="n">ax5</span><span class="p">,</span> <span class="n">ax6</span><span class="p">))</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">],</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;body_size&quot;</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time to merge (seconds)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;body_size&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">],</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files_number&quot;</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;time to merge (seconds)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;changed_file_number&quot;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;body_size&quot;</span><span class="p">],</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files_number&quot;</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;body size&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;changed_file_number&quot;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;changed_files_number&quot;</span><span class="p">])</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;changed_file_number&quot;</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">])</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;time_to_merge (seconds)&quot;</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">],</span> <span class="n">pr_df</span><span class="p">[</span><span class="s2">&quot;body_size&quot;</span><span class="p">])</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;body_size&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Pair-Wise Scatter Plots&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_94_0.png" src="../../../_images/github_PR_EDA_94_0.png" />
</div>
</div>
<p>Its tough to see any meaningful correlations here. Despite this “L” shaped scatter plot the vast majority of the points are centered around (0,0) for the 3 pairs of features in the top row. There is some positive correlation seen between size and changed_file_number and size and body_size since the points appear to increase in the same direction. However, there does not appear to be any correlation seen between time_to_merge and size since the time_to_merge does not change even as size increases. Let’s calculate the correlation value for each pair of variables to see some actual numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_to_merge</th>
      <th>changed_files_number</th>
      <th>body_size</th>
      <th>size</th>
      <th>num_prev_merged_prs</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>created_at_hour</th>
      <th>change_in_.github</th>
      <th>...</th>
      <th>change_in_e2echart</th>
      <th>change_in_examples</th>
      <th>change_in_hack</th>
      <th>change_in_images</th>
      <th>change_in_pkg</th>
      <th>change_in_test</th>
      <th>change_in_tools</th>
      <th>change_in_vendor</th>
      <th>change_in_root</th>
      <th>ttm_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.353000e+04</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>...</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
      <td>17183.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>6.801719e+05</td>
      <td>68.379910</td>
      <td>31.476867</td>
      <td>1.839260</td>
      <td>229.372752</td>
      <td>15.549555</td>
      <td>6.285166</td>
      <td>2.111738</td>
      <td>11.149916</td>
      <td>0.000698</td>
      <td>...</td>
      <td>0.000349</td>
      <td>0.057091</td>
      <td>0.124600</td>
      <td>0.052959</td>
      <td>0.511727</td>
      <td>0.310947</td>
      <td>0.014084</td>
      <td>0.165396</td>
      <td>0.085433</td>
      <td>5.490194</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.848350e+06</td>
      <td>885.774654</td>
      <td>66.186398</td>
      <td>1.593258</td>
      <td>322.057245</td>
      <td>8.733964</td>
      <td>3.314577</td>
      <td>1.542693</td>
      <td>4.896269</td>
      <td>0.026418</td>
      <td>...</td>
      <td>0.018684</td>
      <td>0.232024</td>
      <td>0.330274</td>
      <td>0.223959</td>
      <td>0.499877</td>
      <td>0.462895</td>
      <td>0.117839</td>
      <td>0.371548</td>
      <td>0.279534</td>
      <td>3.122439</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.000000e+00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>3.684875e+04</td>
      <td>1.000000</td>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>19.000000</td>
      <td>8.000000</td>
      <td>3.000000</td>
      <td>1.000000</td>
      <td>8.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>3.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.329870e+05</td>
      <td>2.000000</td>
      <td>14.000000</td>
      <td>2.000000</td>
      <td>87.000000</td>
      <td>16.000000</td>
      <td>6.000000</td>
      <td>2.000000</td>
      <td>11.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>5.245955e+05</td>
      <td>6.000000</td>
      <td>36.000000</td>
      <td>3.000000</td>
      <td>289.000000</td>
      <td>23.000000</td>
      <td>9.000000</td>
      <td>3.000000</td>
      <td>14.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>9.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>5.500529e+07</td>
      <td>48386.000000</td>
      <td>2899.000000</td>
      <td>5.000000</td>
      <td>1429.000000</td>
      <td>31.000000</td>
      <td>12.000000</td>
      <td>6.000000</td>
      <td>23.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>9.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 22 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>time_to_merge</th>
      <th>changed_files_number</th>
      <th>body_size</th>
      <th>size</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>num_prev_merged_prs</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>...</th>
      <th>change_in_e2echart</th>
      <th>change_in_examples</th>
      <th>change_in_hack</th>
      <th>change_in_images</th>
      <th>change_in_pkg</th>
      <th>change_in_test</th>
      <th>change_in_tools</th>
      <th>change_in_vendor</th>
      <th>change_in_root</th>
      <th>ttm_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>time_to_merge</th>
      <td>1.000000</td>
      <td>0.004417</td>
      <td>0.115515</td>
      <td>0.117721</td>
      <td>-0.096736</td>
      <td>-0.102332</td>
      <td>-0.018753</td>
      <td>0.004176</td>
      <td>0.032199</td>
      <td>0.008731</td>
      <td>...</td>
      <td>-0.003522</td>
      <td>-0.012264</td>
      <td>-0.008334</td>
      <td>0.052237</td>
      <td>0.006355</td>
      <td>0.076274</td>
      <td>0.011415</td>
      <td>0.043098</td>
      <td>0.013162</td>
      <td>0.476700</td>
    </tr>
    <tr>
      <th>changed_files_number</th>
      <td>0.004417</td>
      <td>1.000000</td>
      <td>0.028810</td>
      <td>0.144649</td>
      <td>0.022640</td>
      <td>0.038375</td>
      <td>-0.009828</td>
      <td>0.012245</td>
      <td>-0.005152</td>
      <td>0.004709</td>
      <td>...</td>
      <td>-0.001102</td>
      <td>0.111870</td>
      <td>0.120545</td>
      <td>0.064884</td>
      <td>0.017680</td>
      <td>0.060799</td>
      <td>0.297162</td>
      <td>0.101134</td>
      <td>0.143168</td>
      <td>0.051084</td>
    </tr>
    <tr>
      <th>body_size</th>
      <td>0.115515</td>
      <td>0.028810</td>
      <td>1.000000</td>
      <td>0.144166</td>
      <td>-0.046570</td>
      <td>-0.038743</td>
      <td>-0.014049</td>
      <td>0.006723</td>
      <td>-0.010400</td>
      <td>0.002409</td>
      <td>...</td>
      <td>0.002783</td>
      <td>-0.035196</td>
      <td>0.032767</td>
      <td>0.034976</td>
      <td>0.061880</td>
      <td>0.086399</td>
      <td>0.022451</td>
      <td>-0.016925</td>
      <td>-0.021174</td>
      <td>0.140033</td>
    </tr>
    <tr>
      <th>size</th>
      <td>0.117721</td>
      <td>0.144649</td>
      <td>0.144166</td>
      <td>1.000000</td>
      <td>0.105623</td>
      <td>0.101558</td>
      <td>0.037782</td>
      <td>-0.006642</td>
      <td>0.015888</td>
      <td>0.007616</td>
      <td>...</td>
      <td>0.017527</td>
      <td>0.068593</td>
      <td>0.162049</td>
      <td>-0.004033</td>
      <td>0.261642</td>
      <td>0.186384</td>
      <td>0.122105</td>
      <td>0.155420</td>
      <td>0.116169</td>
      <td>0.215049</td>
    </tr>
    <tr>
      <th>is_reviewer</th>
      <td>-0.096736</td>
      <td>0.022640</td>
      <td>-0.046570</td>
      <td>0.105623</td>
      <td>1.000000</td>
      <td>0.834052</td>
      <td>0.020988</td>
      <td>0.021388</td>
      <td>-0.029631</td>
      <td>0.066488</td>
      <td>...</td>
      <td>0.015755</td>
      <td>0.035323</td>
      <td>0.097542</td>
      <td>-0.048938</td>
      <td>0.063370</td>
      <td>0.094600</td>
      <td>0.032614</td>
      <td>0.022099</td>
      <td>0.007114</td>
      <td>-0.170191</td>
    </tr>
    <tr>
      <th>is_approver</th>
      <td>-0.102332</td>
      <td>0.038375</td>
      <td>-0.038743</td>
      <td>0.101558</td>
      <td>0.834052</td>
      <td>1.000000</td>
      <td>0.019125</td>
      <td>0.018234</td>
      <td>-0.039108</td>
      <td>0.037910</td>
      <td>...</td>
      <td>0.011703</td>
      <td>0.031128</td>
      <td>0.096303</td>
      <td>-0.039032</td>
      <td>0.055353</td>
      <td>0.069149</td>
      <td>0.033465</td>
      <td>0.052098</td>
      <td>0.010770</td>
      <td>-0.163709</td>
    </tr>
    <tr>
      <th>num_prev_merged_prs</th>
      <td>-0.018753</td>
      <td>-0.009828</td>
      <td>-0.014049</td>
      <td>0.037782</td>
      <td>0.020988</td>
      <td>0.019125</td>
      <td>1.000000</td>
      <td>-0.016880</td>
      <td>-0.099440</td>
      <td>-0.001537</td>
      <td>...</td>
      <td>-0.013137</td>
      <td>-0.064679</td>
      <td>0.027780</td>
      <td>-0.036691</td>
      <td>0.013441</td>
      <td>0.020455</td>
      <td>0.005067</td>
      <td>-0.022072</td>
      <td>0.002253</td>
      <td>-0.023095</td>
    </tr>
    <tr>
      <th>created_at_day</th>
      <td>0.004176</td>
      <td>0.012245</td>
      <td>0.006723</td>
      <td>-0.006642</td>
      <td>0.021388</td>
      <td>0.018234</td>
      <td>-0.016880</td>
      <td>1.000000</td>
      <td>-0.054627</td>
      <td>-0.009093</td>
      <td>...</td>
      <td>0.006314</td>
      <td>0.008096</td>
      <td>-0.002877</td>
      <td>0.003389</td>
      <td>-0.004855</td>
      <td>0.015543</td>
      <td>0.004129</td>
      <td>0.005635</td>
      <td>-0.001067</td>
      <td>-0.001453</td>
    </tr>
    <tr>
      <th>created_at_month</th>
      <td>0.032199</td>
      <td>-0.005152</td>
      <td>-0.010400</td>
      <td>0.015888</td>
      <td>-0.029631</td>
      <td>-0.039108</td>
      <td>-0.099440</td>
      <td>-0.054627</td>
      <td>1.000000</td>
      <td>-0.026082</td>
      <td>...</td>
      <td>-0.014765</td>
      <td>0.004333</td>
      <td>0.012625</td>
      <td>-0.007644</td>
      <td>-0.025272</td>
      <td>0.024974</td>
      <td>-0.010879</td>
      <td>0.013779</td>
      <td>0.030803</td>
      <td>0.041676</td>
    </tr>
    <tr>
      <th>created_at_weekday</th>
      <td>0.008731</td>
      <td>0.004709</td>
      <td>0.002409</td>
      <td>0.007616</td>
      <td>0.066488</td>
      <td>0.037910</td>
      <td>-0.001537</td>
      <td>-0.009093</td>
      <td>-0.026082</td>
      <td>1.000000</td>
      <td>...</td>
      <td>-0.015488</td>
      <td>-0.003352</td>
      <td>0.014366</td>
      <td>-0.000957</td>
      <td>-0.009926</td>
      <td>0.015076</td>
      <td>0.008951</td>
      <td>0.002583</td>
      <td>0.022130</td>
      <td>0.023051</td>
    </tr>
    <tr>
      <th>created_at_hour</th>
      <td>-0.025977</td>
      <td>-0.019019</td>
      <td>0.027592</td>
      <td>0.051971</td>
      <td>0.147640</td>
      <td>0.031878</td>
      <td>-0.012987</td>
      <td>-0.017174</td>
      <td>-0.035043</td>
      <td>0.038989</td>
      <td>...</td>
      <td>0.002609</td>
      <td>-0.000260</td>
      <td>0.012274</td>
      <td>0.027205</td>
      <td>0.057279</td>
      <td>0.000719</td>
      <td>-0.007896</td>
      <td>-0.042168</td>
      <td>-0.009146</td>
      <td>-0.016692</td>
    </tr>
    <tr>
      <th>change_in_.github</th>
      <td>0.009195</td>
      <td>0.053228</td>
      <td>-0.005749</td>
      <td>0.005433</td>
      <td>-0.011847</td>
      <td>-0.006324</td>
      <td>-0.011625</td>
      <td>-0.022347</td>
      <td>-0.002939</td>
      <td>0.010938</td>
      <td>...</td>
      <td>-0.000494</td>
      <td>0.021980</td>
      <td>0.010038</td>
      <td>0.023259</td>
      <td>-0.013842</td>
      <td>-0.003481</td>
      <td>0.052926</td>
      <td>0.000090</td>
      <td>0.031326</td>
      <td>0.017722</td>
    </tr>
    <tr>
      <th>change_in_cmd</th>
      <td>0.004834</td>
      <td>0.215083</td>
      <td>0.049231</td>
      <td>0.132196</td>
      <td>0.051883</td>
      <td>0.050978</td>
      <td>0.001879</td>
      <td>-0.004365</td>
      <td>0.011268</td>
      <td>0.006919</td>
      <td>...</td>
      <td>-0.003075</td>
      <td>0.062840</td>
      <td>0.122697</td>
      <td>0.087603</td>
      <td>-0.008584</td>
      <td>0.058967</td>
      <td>0.159127</td>
      <td>0.023538</td>
      <td>0.123842</td>
      <td>0.037454</td>
    </tr>
    <tr>
      <th>change_in_docs</th>
      <td>0.064161</td>
      <td>0.108738</td>
      <td>0.051589</td>
      <td>0.129191</td>
      <td>-0.003584</td>
      <td>-0.004837</td>
      <td>-0.041726</td>
      <td>-0.002821</td>
      <td>0.033794</td>
      <td>-0.001528</td>
      <td>...</td>
      <td>-0.003846</td>
      <td>0.084050</td>
      <td>0.075899</td>
      <td>0.043485</td>
      <td>0.076560</td>
      <td>0.036913</td>
      <td>0.108001</td>
      <td>-0.013050</td>
      <td>0.038355</td>
      <td>0.058807</td>
    </tr>
    <tr>
      <th>change_in_e2echart</th>
      <td>-0.003522</td>
      <td>-0.001102</td>
      <td>0.002783</td>
      <td>0.017527</td>
      <td>0.015755</td>
      <td>0.011703</td>
      <td>-0.013137</td>
      <td>0.006314</td>
      <td>-0.014765</td>
      <td>-0.015488</td>
      <td>...</td>
      <td>1.000000</td>
      <td>-0.004599</td>
      <td>-0.007051</td>
      <td>-0.004420</td>
      <td>0.005793</td>
      <td>0.021092</td>
      <td>-0.002234</td>
      <td>0.000064</td>
      <td>0.016575</td>
      <td>0.008040</td>
    </tr>
    <tr>
      <th>change_in_examples</th>
      <td>-0.012264</td>
      <td>0.111870</td>
      <td>-0.035196</td>
      <td>0.068593</td>
      <td>0.035323</td>
      <td>0.031128</td>
      <td>-0.064679</td>
      <td>0.008096</td>
      <td>0.004333</td>
      <td>-0.003352</td>
      <td>...</td>
      <td>-0.004599</td>
      <td>1.000000</td>
      <td>0.085645</td>
      <td>0.037013</td>
      <td>-0.000504</td>
      <td>0.039537</td>
      <td>0.115338</td>
      <td>-0.060256</td>
      <td>0.031578</td>
      <td>0.006035</td>
    </tr>
    <tr>
      <th>change_in_hack</th>
      <td>-0.008334</td>
      <td>0.120545</td>
      <td>0.032767</td>
      <td>0.162049</td>
      <td>0.097542</td>
      <td>0.096303</td>
      <td>0.027780</td>
      <td>-0.002877</td>
      <td>0.012625</td>
      <td>0.014366</td>
      <td>...</td>
      <td>-0.007051</td>
      <td>0.085645</td>
      <td>1.000000</td>
      <td>0.102772</td>
      <td>-0.037581</td>
      <td>0.022941</td>
      <td>0.152303</td>
      <td>-0.050327</td>
      <td>0.163960</td>
      <td>-0.006236</td>
    </tr>
    <tr>
      <th>change_in_images</th>
      <td>0.052237</td>
      <td>0.064884</td>
      <td>0.034976</td>
      <td>-0.004033</td>
      <td>-0.048938</td>
      <td>-0.039032</td>
      <td>-0.036691</td>
      <td>0.003389</td>
      <td>-0.007644</td>
      <td>-0.000957</td>
      <td>...</td>
      <td>-0.004420</td>
      <td>0.037013</td>
      <td>0.102772</td>
      <td>1.000000</td>
      <td>-0.092366</td>
      <td>-0.047698</td>
      <td>0.042306</td>
      <td>-0.053513</td>
      <td>0.069962</td>
      <td>0.057753</td>
    </tr>
    <tr>
      <th>change_in_pkg</th>
      <td>0.006355</td>
      <td>0.017680</td>
      <td>0.061880</td>
      <td>0.261642</td>
      <td>0.063370</td>
      <td>0.055353</td>
      <td>0.013441</td>
      <td>-0.004855</td>
      <td>-0.025272</td>
      <td>-0.009926</td>
      <td>...</td>
      <td>0.005793</td>
      <td>-0.000504</td>
      <td>-0.037581</td>
      <td>-0.092366</td>
      <td>1.000000</td>
      <td>-0.063423</td>
      <td>0.025849</td>
      <td>-0.248599</td>
      <td>-0.150034</td>
      <td>0.000512</td>
    </tr>
    <tr>
      <th>change_in_test</th>
      <td>0.076274</td>
      <td>0.060799</td>
      <td>0.086399</td>
      <td>0.186384</td>
      <td>0.094600</td>
      <td>0.069149</td>
      <td>0.020455</td>
      <td>0.015543</td>
      <td>0.024974</td>
      <td>0.015076</td>
      <td>...</td>
      <td>0.021092</td>
      <td>0.039537</td>
      <td>0.022941</td>
      <td>-0.047698</td>
      <td>-0.063423</td>
      <td>1.000000</td>
      <td>0.059485</td>
      <td>-0.136954</td>
      <td>-0.052837</td>
      <td>0.102073</td>
    </tr>
    <tr>
      <th>change_in_tools</th>
      <td>0.011415</td>
      <td>0.297162</td>
      <td>0.022451</td>
      <td>0.122105</td>
      <td>0.032614</td>
      <td>0.033465</td>
      <td>0.005067</td>
      <td>0.004129</td>
      <td>-0.010879</td>
      <td>0.008951</td>
      <td>...</td>
      <td>-0.002234</td>
      <td>0.115338</td>
      <td>0.152303</td>
      <td>0.042306</td>
      <td>0.025849</td>
      <td>0.059485</td>
      <td>1.000000</td>
      <td>0.049149</td>
      <td>0.083617</td>
      <td>0.034858</td>
    </tr>
    <tr>
      <th>change_in_vendor</th>
      <td>0.043098</td>
      <td>0.101134</td>
      <td>-0.016925</td>
      <td>0.155420</td>
      <td>0.022099</td>
      <td>0.052098</td>
      <td>-0.022072</td>
      <td>0.005635</td>
      <td>0.013779</td>
      <td>0.002583</td>
      <td>...</td>
      <td>0.000064</td>
      <td>-0.060256</td>
      <td>-0.050327</td>
      <td>-0.053513</td>
      <td>-0.248599</td>
      <td>-0.136954</td>
      <td>0.049149</td>
      <td>1.000000</td>
      <td>0.111065</td>
      <td>0.113722</td>
    </tr>
    <tr>
      <th>change_in_root</th>
      <td>0.013162</td>
      <td>0.143168</td>
      <td>-0.021174</td>
      <td>0.116169</td>
      <td>0.007114</td>
      <td>0.010770</td>
      <td>0.002253</td>
      <td>-0.001067</td>
      <td>0.030803</td>
      <td>0.022130</td>
      <td>...</td>
      <td>0.016575</td>
      <td>0.031578</td>
      <td>0.163960</td>
      <td>0.069962</td>
      <td>-0.150034</td>
      <td>-0.052837</td>
      <td>0.083617</td>
      <td>0.111065</td>
      <td>1.000000</td>
      <td>0.028099</td>
    </tr>
    <tr>
      <th>ttm_class</th>
      <td>0.476700</td>
      <td>0.051084</td>
      <td>0.140033</td>
      <td>0.215049</td>
      <td>-0.170191</td>
      <td>-0.163709</td>
      <td>-0.023095</td>
      <td>-0.001453</td>
      <td>0.041676</td>
      <td>0.023051</td>
      <td>...</td>
      <td>0.008040</td>
      <td>0.006035</td>
      <td>-0.006236</td>
      <td>0.057753</td>
      <td>0.000512</td>
      <td>0.102073</td>
      <td>0.034858</td>
      <td>0.113722</td>
      <td>0.028099</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>24 rows × 24 columns</p>
</div></div></div>
</div>
<p>From the correlation values, above we do not see any strong correlation between <code class="docutils literal notranslate"><span class="pre">time</span> <span class="pre">to</span> <span class="pre">merge</span></code> and other variables. We can see that body_size and size are <em>most</em> correlated with time_to_merge, but 0.11 is a rather weak correlation value. This is good if we are going to use these as input features to a model, but not so good if we wanted to try and predict one value from the other two.  In the next section, we will calculate feature importance scores for our features to select the most important features for our model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># NOTE: rows where the `time_to_merge` value is nan represent the PR&#39;s that did not get merged</span>
<span class="c1"># since predicting time to close/reject is out of the scope of this exploration</span>
<span class="c1"># we will drop those rows from further analysus</span>
<span class="n">feature_df</span> <span class="o">=</span> <span class="n">feature_df</span><span class="p">[</span><span class="o">~</span><span class="n">feature_df</span><span class="p">[</span><span class="s2">&quot;time_to_merge&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
<span class="n">feature_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(13530, 27)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="evaluating-feature-importances">
<h2>Evaluating Feature Importances<a class="headerlink" href="#evaluating-feature-importances" title="Permalink to this headline">¶</a></h2>
<div class="section" id="categorical-features">
<h3>Categorical Features<a class="headerlink" href="#categorical-features" title="Permalink to this headline">¶</a></h3>
<p>First, lets try to determine what categorical featuers are powerful influencers for time to merge of a PR</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># feature selection helper function</span>
<span class="k">def</span> <span class="nf">select_features</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">score_func</span><span class="o">=</span><span class="n">func</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">x_fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_fs</span><span class="p">,</span> <span class="n">fs</span>


<span class="n">selected_features</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_df</span> <span class="o">=</span> <span class="n">feature_df</span><span class="p">[</span>
    <span class="p">[</span>
        <span class="s2">&quot;size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_reviewer&quot;</span><span class="p">,</span>
        <span class="s2">&quot;is_approver&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_day&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_month&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_weekday&quot;</span><span class="p">,</span>
        <span class="s2">&quot;created_at_hour&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_.github&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_cmd&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_docs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_e2echart&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_examples&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_hack&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_images&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_pkg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_test&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_tools&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_vendor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;change_in_root&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ttm_class&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="n">cat_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>size</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>created_at_hour</th>
      <th>change_in_.github</th>
      <th>change_in_cmd</th>
      <th>change_in_docs</th>
      <th>change_in_e2echart</th>
      <th>change_in_examples</th>
      <th>change_in_hack</th>
      <th>change_in_images</th>
      <th>change_in_pkg</th>
      <th>change_in_test</th>
      <th>change_in_tools</th>
      <th>change_in_vendor</th>
      <th>change_in_root</th>
      <th>ttm_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>11</td>
      <td>8</td>
      <td>0</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>False</td>
      <td>True</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># split into input (X) and output (y) variables</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cat_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">cat_df</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rank using mutual_info_classif</span>
<span class="n">X_fs</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">select_features</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">mutual_info_classif</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature </span><span class="si">%s</span><span class="s2">: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Feature size: 0.044264
Feature is_reviewer: 0.000000
Feature is_approver: 0.010190
Feature created_at_day: 0.000000
Feature created_at_month: 0.005857
Feature created_at_weekday: 0.034658
Feature created_at_hour: 0.009211
Feature change_in_.github: 0.000000
Feature change_in_cmd: 0.005738
Feature change_in_docs: 0.005591
Feature change_in_e2echart: 0.000000
Feature change_in_examples: 0.000000
Feature change_in_hack: 0.000000
Feature change_in_images: 0.005793
Feature change_in_pkg: 0.000000
Feature change_in_test: 0.008334
Feature change_in_tools: 0.000000
Feature change_in_vendor: 0.013850
Feature change_in_root: 0.010854
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize scores of all features</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature importance scores for Mutual Information Statistic&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Features&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Scores&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_106_0.png" src="../../../_images/github_PR_EDA_106_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets get a list of the top 10 feature indices based on Mutual Info Stat feature scores</span>
<span class="n">top_mis</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="mi">10</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rank using chi_sq</span>
<span class="n">X_fs</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="n">select_features</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">chi2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature </span><span class="si">%s</span><span class="s2">: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Feature size: 1366.621250
Feature is_reviewer: 236.344523
Feature is_approver: 230.186533
Feature created_at_day: 142.625122
Feature created_at_month: 79.020129
Feature created_at_weekday: 304.529657
Feature created_at_hour: 443.231756
Feature change_in_.github: 11.115579
Feature change_in_cmd: 13.926693
Feature change_in_docs: 103.058228
Feature change_in_e2echart: 6.738201
Feature change_in_examples: 15.022310
Feature change_in_hack: 9.801802
Feature change_in_images: 52.527167
Feature change_in_pkg: 72.741790
Feature change_in_test: 210.102073
Feature change_in_tools: 21.982763
Feature change_in_vendor: 141.668045
Feature change_in_root: 56.153303
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualize scores of all features</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature importance scores for Chi Squared&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Features&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Scores&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_110_0.png" src="../../../_images/github_PR_EDA_110_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets get a list of the top 10 feature indices based on Chi Sq feature scores</span>
<span class="n">top_chi2</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">scores_</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[</span><span class="o">-</span><span class="mi">10</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s get a Union of the top 10 features derived from features based on both scores of both Mutual Info Statistic and Chi Squared</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">union</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">top_mis</span><span class="p">)</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">top_chi2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">union</span><span class="p">))</span>
<span class="n">union</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0, 1, 2, 3, 4, 5, 6, 8, 9, 13, 15, 17, 18}
</pre></div>
</div>
</div>
</div>
<p>We now have the top 12 features based on their feature importance scores. We can eliminate the remaining 7 features from the categorical features which have low feature importance scores for both  Mutual Info Statistic and Chi Squared</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cat_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>size</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>created_at_hour</th>
      <th>change_in_.github</th>
      <th>change_in_cmd</th>
      <th>change_in_docs</th>
      <th>change_in_e2echart</th>
      <th>change_in_examples</th>
      <th>change_in_hack</th>
      <th>change_in_images</th>
      <th>change_in_pkg</th>
      <th>change_in_test</th>
      <th>change_in_tools</th>
      <th>change_in_vendor</th>
      <th>change_in_root</th>
      <th>ttm_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>11</td>
      <td>8</td>
      <td>0</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>False</td>
      <td>True</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># update list of features to keep for training</span>
<span class="n">selected_features</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="s2">&quot;size&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_reviewer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;is_approver&quot;</span><span class="p">,</span>
    <span class="s2">&quot;created_at_day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;created_at_month&quot;</span><span class="p">,</span>
    <span class="s2">&quot;created_at_weekday&quot;</span><span class="p">,</span>
    <span class="s2">&quot;created_at_hour&quot;</span><span class="p">,</span>
    <span class="s2">&quot;change_in_.github&quot;</span><span class="p">,</span>
    <span class="s2">&quot;change_in_docs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;change_in_pkg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;change_in_test&quot;</span><span class="p">,</span>
    <span class="s2">&quot;change_in_vendor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;change_in_root&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="numerical-features">
<h3>Numerical Features<a class="headerlink" href="#numerical-features" title="Permalink to this headline">¶</a></h3>
<p>Now, lets try to determine what numerical featuers are powerful influencers for time to merge of a PR</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numerical_df</span> <span class="o">=</span> <span class="n">feature_df</span><span class="p">[</span>
    <span class="p">[</span>
        <span class="s2">&quot;changed_files_number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;body_size&quot;</span><span class="p">,</span>
        <span class="s2">&quot;num_prev_merged_prs&quot;</span><span class="p">,</span>
        <span class="s2">&quot;commits_number&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ttm_class&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span>

<span class="n">numerical_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>changed_files_number</th>
      <th>body_size</th>
      <th>num_prev_merged_prs</th>
      <th>commits_number</th>
      <th>ttm_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>54</td>
      <td>3</td>
      <td>0.0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>7</td>
      <td>0</td>
      <td>0.0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>42</td>
      <td>0.0</td>
      <td>2</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># split into input features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">numerical_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numerical_df</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create k best feature selector object based on mutual information</span>
<span class="n">numerical_feats_mi</span><span class="p">,</span> <span class="n">k_best_selector_mi</span> <span class="o">=</span> <span class="n">select_features</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">partial</span><span class="p">(</span>
        <span class="n">mutual_info_classif</span><span class="p">,</span>
        <span class="n">discrete_features</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
        <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>

<span class="c1"># visualize the MI scores of all features</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">k_best_selector_mi</span><span class="o">.</span><span class="n">scores_</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature importance based on Mutual Information&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Features&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Scores&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_120_0.png" src="../../../_images/github_PR_EDA_120_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create k best feature selector object based on anova f statistic</span>
<span class="n">numerical_feats_f</span><span class="p">,</span> <span class="n">k_best_selector_f</span> <span class="o">=</span> <span class="n">select_features</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">f_classif</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># visualize the f stat scores and pvalues of all features</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Feature importance based on ANOVA F stat&quot;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">k_best_selector_f</span><span class="o">.</span><span class="n">scores_</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">k_best_selector_f</span><span class="o">.</span><span class="n">pvalues_</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Features&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Scores&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;p-values&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/github_PR_EDA_121_0.png" src="../../../_images/github_PR_EDA_121_0.png" />
</div>
</div>
<p>From the above cells, we can see that all numerical featuers seem to have similar importances based on the mutual information criterion. Based on ANOVA F statistic, all but one (<code class="docutils literal notranslate"><span class="pre">body_size</span></code>) of them have similar scores. Since there are only 4 of these features, we will keep all of them in our features dataframe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># update list of features to keep for training</span>
<span class="n">selected_features</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="s2">&quot;changed_files_number&quot;</span><span class="p">,</span>
    <span class="s2">&quot;body_size&quot;</span><span class="p">,</span>
    <span class="s2">&quot;num_prev_merged_prs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;commits_number&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="count-vector-type-features">
<h3>Count Vector Type Features<a class="headerlink" href="#count-vector-type-features" title="Permalink to this headline">¶</a></h3>
<p>Finally, lets determine the most important features from the count vector type columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># explode the list column so that there is 1 column representing frequency of each file type</span>
<span class="n">filetype_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_df</span><span class="o">.</span><span class="n">changed_file_type_vec</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
<span class="n">filetype_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">feature_df</span><span class="o">.</span><span class="n">index</span>
<span class="n">filetype_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;filetype_</span><span class="si">{f}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">top_fileextensions</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute correlation with ttm</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">filetype_df</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">feature_df</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">])</span>
<span class="n">corr</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>filetype_openshift                     0.117514
filetype_oc                            0.114041
filetype_oadm                          0.067057
filetype_.files_generated_oc           0.057013
filetype_.files_generated_openshift    0.054466
                                         ...   
filetype_.in                          -0.000853
filetype_None                         -0.005314
filetype_.scss                        -0.005494
filetype_OWNERS                       -0.009672
filetype_Vagrantfile                  -0.020005
Length: 100, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span><span class="p">[</span><span class="n">corr</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>filetype_.go                  0.045924
filetype_.json                0.022556
filetype_.1                   0.023154
filetype_.sh                  0.039563
filetype_.md                  0.026897
                                ...   
filetype_test                 0.016087
filetype_.sysconfig           0.019626
filetype_.yaml-merge-patch    0.012821
filetype_.gitattributes       0.010586
filetype_.signature           0.017807
Length: 64, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># update list of features to keep for training</span>
<span class="c1"># take everything that has more than 0.01 correlation magnitude</span>
<span class="n">keep_cols</span> <span class="o">=</span> <span class="n">corr</span><span class="p">[</span><span class="n">corr</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">selected_features</span> <span class="o">+=</span> <span class="n">keep_cols</span>

<span class="c1"># only keep the relevant columns now</span>
<span class="n">filetype_df</span> <span class="o">=</span> <span class="n">filetype_df</span><span class="p">[</span><span class="n">keep_cols</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># explode the list column so that there is 1 column representing frequency of each word</span>
<span class="n">title_wordcount_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">feature_df</span><span class="o">.</span><span class="n">title_word_counts_vec</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

<span class="n">title_wordcount_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">feature_df</span><span class="o">.</span><span class="n">index</span>
<span class="n">title_wordcount_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="s2">&quot;title_wordcount_</span><span class="si">{w}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">unique_words</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute correlation with ttm</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">title_wordcount_df</span><span class="o">.</span><span class="n">corrwith</span><span class="p">(</span><span class="n">feature_df</span><span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">])</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">corr</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>title_wordcount_bug           0.108769
title_wordcount_oc            0.056590
title_wordcount_support       0.053857
title_wordcount_router        0.052250
title_wordcount_add           0.049126
                                ...   
title_wordcount_revert       -0.045302
title_wordcount_disable      -0.049128
title_wordcount_fix          -0.054172
title_wordcount_publishing   -0.057387
title_wordcount_bump         -0.070319
Length: 7033, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span><span class="p">[</span><span class="n">corr</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.04</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>title_wordcount_add            0.049126
title_wordcount_bug            0.108769
title_wordcount_bump          -0.070319
title_wordcount_diagnostics    0.041924
title_wordcount_disable       -0.049128
title_wordcount_fix           -0.054172
title_wordcount_haproxy        0.041492
title_wordcount_oc             0.056590
title_wordcount_publishing    -0.057387
title_wordcount_revert        -0.045302
title_wordcount_router         0.052250
title_wordcount_sh            -0.040293
title_wordcount_staging       -0.044244
title_wordcount_support        0.053857
title_wordcount_travis        -0.043066
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># update list of features to keep for training</span>
<span class="c1"># take everything that has more than 0.01 correlation magnitude</span>
<span class="n">keep_cols</span> <span class="o">=</span> <span class="n">corr</span><span class="p">[</span><span class="n">corr</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.04</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">selected_features</span> <span class="o">+=</span> <span class="n">keep_cols</span>

<span class="n">title_wordcount_df</span> <span class="o">=</span> <span class="n">title_wordcount_df</span><span class="p">[</span><span class="n">keep_cols</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Using various feature importance scores such as chi-squared, mutual information statistic, correlation values, we have selected the most relevant features amongst all of our features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selected_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;size&#39;,
 &#39;is_reviewer&#39;,
 &#39;is_approver&#39;,
 &#39;created_at_day&#39;,
 &#39;created_at_month&#39;,
 &#39;created_at_weekday&#39;,
 &#39;created_at_hour&#39;,
 &#39;change_in_.github&#39;,
 &#39;change_in_docs&#39;,
 &#39;change_in_pkg&#39;,
 &#39;change_in_test&#39;,
 &#39;change_in_vendor&#39;,
 &#39;change_in_root&#39;,
 &#39;changed_files_number&#39;,
 &#39;body_size&#39;,
 &#39;num_prev_merged_prs&#39;,
 &#39;commits_number&#39;,
 &#39;filetype_.go&#39;,
 &#39;filetype_.json&#39;,
 &#39;filetype_.1&#39;,
 &#39;filetype_.sh&#39;,
 &#39;filetype_.md&#39;,
 &#39;filetype_.yaml&#39;,
 &#39;filetype_BUILD&#39;,
 &#39;filetype_.proto&#39;,
 &#39;filetype_.yml&#39;,
 &#39;filetype_.html&#39;,
 &#39;filetype_.adoc&#39;,
 &#39;filetype_Dockerfile&#39;,
 &#39;filetype_LICENSE&#39;,
 &#39;filetype_Makefile&#39;,
 &#39;filetype_.txt&#39;,
 &#39;filetype_.gitignore&#39;,
 &#39;filetype_oc&#39;,
 &#39;filetype_.s&#39;,
 &#39;filetype_.mod&#39;,
 &#39;filetype_openshift&#39;,
 &#39;filetype_.sum&#39;,
 &#39;filetype_.conf&#39;,
 &#39;filetype_.bats&#39;,
 &#39;filetype_.feature&#39;,
 &#39;filetype_.xml&#39;,
 &#39;filetype_.crt&#39;,
 &#39;filetype_.spec&#39;,
 &#39;filetype_.template&#39;,
 &#39;filetype_AUTHORS&#39;,
 &#39;filetype_.service&#39;,
 &#39;filetype_.key&#39;,
 &#39;filetype_run&#39;,
 &#39;filetype_.mk&#39;,
 &#39;filetype_oadm&#39;,
 &#39;filetype_.rhel&#39;,
 &#39;filetype_.cert&#39;,
 &#39;filetype_result&#39;,
 &#39;filetype_MAINTAINERS&#39;,
 &#39;filetype_README&#39;,
 &#39;filetype_NOTICE&#39;,
 &#39;filetype_.c&#39;,
 &#39;filetype_.bash&#39;,
 &#39;filetype_.pl&#39;,
 &#39;filetype_Vagrantfile&#39;,
 &#39;filetype_.centos7&#39;,
 &#39;filetype_CONTRIBUTORS&#39;,
 &#39;filetype_.gz&#39;,
 &#39;filetype_cert&#39;,
 &#39;filetype_key&#39;,
 &#39;filetype_.files_generated_oc&#39;,
 &#39;filetype_Readme&#39;,
 &#39;filetype_.empty&#39;,
 &#39;filetype_PATENTS&#39;,
 &#39;filetype_.files_generated_openshift&#39;,
 &#39;filetype_.sec&#39;,
 &#39;filetype_VERSION&#39;,
 &#39;filetype_.ini&#39;,
 &#39;filetype_.mailmap&#39;,
 &#39;filetype_.markdown&#39;,
 &#39;filetype_test&#39;,
 &#39;filetype_.sysconfig&#39;,
 &#39;filetype_.yaml-merge-patch&#39;,
 &#39;filetype_.gitattributes&#39;,
 &#39;filetype_.signature&#39;,
 &#39;title_wordcount_add&#39;,
 &#39;title_wordcount_bug&#39;,
 &#39;title_wordcount_bump&#39;,
 &#39;title_wordcount_diagnostics&#39;,
 &#39;title_wordcount_disable&#39;,
 &#39;title_wordcount_fix&#39;,
 &#39;title_wordcount_haproxy&#39;,
 &#39;title_wordcount_oc&#39;,
 &#39;title_wordcount_publishing&#39;,
 &#39;title_wordcount_revert&#39;,
 &#39;title_wordcount_router&#39;,
 &#39;title_wordcount_sh&#39;,
 &#39;title_wordcount_staging&#39;,
 &#39;title_wordcount_support&#39;,
 &#39;title_wordcount_travis&#39;]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="save-feature-engineered-dataset">
<h2>Save Feature Engineered Dataset<a class="headerlink" href="#save-feature-engineered-dataset" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># join all types of features</span>
<span class="n">ttm_dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">feature_df</span><span class="p">,</span> <span class="n">filetype_df</span><span class="p">,</span> <span class="n">title_wordcount_df</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># keep only the selected features and the prediction label</span>
<span class="n">ttm_dataset</span> <span class="o">=</span> <span class="n">ttm_dataset</span><span class="p">[</span><span class="n">selected_features</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;ttm_class&quot;</span><span class="p">]]</span>

<span class="n">ttm_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>size</th>
      <th>is_reviewer</th>
      <th>is_approver</th>
      <th>created_at_day</th>
      <th>created_at_month</th>
      <th>created_at_weekday</th>
      <th>created_at_hour</th>
      <th>change_in_.github</th>
      <th>change_in_docs</th>
      <th>change_in_pkg</th>
      <th>...</th>
      <th>title_wordcount_haproxy</th>
      <th>title_wordcount_oc</th>
      <th>title_wordcount_publishing</th>
      <th>title_wordcount_revert</th>
      <th>title_wordcount_router</th>
      <th>title_wordcount_sh</th>
      <th>title_wordcount_staging</th>
      <th>title_wordcount_support</th>
      <th>title_wordcount_travis</th>
      <th>ttm_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>11</td>
      <td>8</td>
      <td>0</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>5</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>False</td>
      <td>True</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>False</td>
      <td>False</td>
      <td>12</td>
      <td>8</td>
      <td>1</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 97 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="save-results-to-ceph-or-locally">
<h2>Save results to Ceph or locally<a class="headerlink" href="#save-results-to-ceph-or-locally" title="Permalink to this headline">¶</a></h2>
<p>Using the helper function to save the data frame in a parquet format on the Ceph bucket if we are running in automation, and locally if not.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Sanity check to see if the dataset is the same</span>

<span class="k">if</span> <span class="n">REMOTE</span><span class="p">:</span>
    <span class="n">cc</span> <span class="o">=</span> <span class="n">CephCommunication</span><span class="p">(</span><span class="n">s3_endpoint_url</span><span class="p">,</span> <span class="n">s3_access_key</span><span class="p">,</span> <span class="n">s3_secret_key</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cc</span><span class="o">.</span><span class="n">upload_to_ceph</span><span class="p">(</span>
            <span class="n">ttm_dataset</span><span class="p">,</span>
            <span class="n">s3_path</span><span class="p">,</span>
            <span class="s2">&quot;ttm_dataset.parquet&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">ve</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Files already uploaded to S3&quot;</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="n">save_to_disk</span><span class="p">(</span>
        <span class="n">ttm_dataset</span><span class="p">,</span>
        <span class="n">OUTPUT_DATA_PATH</span><span class="p">,</span>
        <span class="s2">&quot;ttm_dataset.parquet&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="conlusion">
<h1>Conlusion<a class="headerlink" href="#conlusion" title="Permalink to this headline">¶</a></h1>
<p>This notebook walked through how to access the relevant PR data for the OpenShift Origin project we whish to analyze along with the rest of the related CI data in this project. We also outlined what is contained in each record and provided a quick demonstration of how to convert the mixed data types into numerical values for statistical analysis and eventually machine learning.</p>
<p>We have also engineered some possible features which can be used to predict time to merge of a PR.</p>
<ul class="simple">
<li><p>time_to_merge: time taken to merge a PR in seconds, this is feature we will try to predict</p></li>
<li><p>changed_files_number: integer indicating the number of files changed, this is an available column</p></li>
<li><p>body_size: integer indicating the number of words in the body of the PR, derived from body</p></li>
<li><p>size: integer corresponding to a categorical label generated by GitHub which summerizes the size of the changes made to the code base</p></li>
<li><p>title_word_counts_vec: vector or list indicating how many times each word appeared in the title</p></li>
<li><p>is_reviewer: categorical variable indicating whether the creator of the PR is a reviewer, derived from created_by and additional repo data</p></li>
<li><p>is_approver: categorical variable indicating whether the creator of the PR is an approver, derived from created_by and additional repo data</p></li>
<li><p>num_prev_merged_prs: categorical variable indicating whether the creator of the PR has previously created PRs, derived from created_by</p></li>
<li><p>created_at_day: categorical variable indicating the day of month the PR has been created, derived from created_at</p></li>
<li><p>created_at_month: categorical variable indicating the month of the year that the PR has been created, derived from created_at</p></li>
<li><p>created_at_weekday: categorical variable indicating the day of the week the PR has been created, derived from created_at</p></li>
<li><p>created_at_hour: categorical variable indicating the hour of the day the PR has been created, derived from created_at</p></li>
<li><p>commits_number: integer indicating the number of commiyts in the PR</p></li>
<li><p>changed_file_type_vec:  vector or list consisting of number of files changed for the top 100 most frequently occuring datatypes, derived from changed_files</p></li>
<li><p>change_in_.github: categorical variable indicating whether the PR changes a file in the .github directory, derived from changed_files</p></li>
<li><p>change_in_cmd: categorical variable indicating whether the PR changes a file in the cmd directory, derived from changed_files</p></li>
<li><p>change_in_docs: categorical variable indicating whether the PR changes a file in the docs directory, derived from changed_files</p></li>
<li><p>change_in_e2echart: categorical variable indicating whether the PR changes a file in the e2echart directory, derived from changed_files</p></li>
<li><p>change_in_examples: categorical variable indicating whether the PR changes a file in the examples directory, derived from changed_files</p></li>
<li><p>change_in_hack: categorical variable indicating whether the PR changes a file in the hack directory, derived from changed_files</p></li>
<li><p>change_in_images: categorical variable indicating whether the PR changes a file in the images directory, derived from changed_files</p></li>
<li><p>change_in_pkg: categorical variable indicating whether the PR changes a file in the pkg directory, derived from changed_files</p></li>
<li><p>change_in_test: categorical variable indicating whether the PR changes a file in the test directory, derived from changed_files</p></li>
<li><p>change_in_tools: categorical variable indicating whether the PR changes a file in the tools directory, derived from changed_files</p></li>
<li><p>change_in_vendor: categorical variable indicating whether the PR changes a file in the vendor directory, derived from changed_files</p></li>
<li><p>change_in_root: categorical variable indicating whether the PR changes a file in the root directory of the repo, derived from changed_files</p></li>
</ul>
<p>As next steps, we will train a classifier to predict time to merge of a PR using the features.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/data-sources/oc-github-repo"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="../Bugzilla/bugzilla_EDA.html" title="previous page">Bugzilla Data for CI Tests on Testgrid</a>
    <a class='right-next' id="next-link" href="../Sippy/stage/sippy_EDA.html" title="next page">Sippy Export of OpenShift Data - EDA</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By AIOps<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>