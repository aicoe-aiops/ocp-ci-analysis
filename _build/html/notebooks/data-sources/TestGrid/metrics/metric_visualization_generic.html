
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KPI Metrics Visualization &#8212; AI Supported Continuous Integration</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/clipboard.min.js"></script>
    <script src="../../../../_static/copybutton.js"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Bugzilla Data for CI Tests on Testgrid" href="../../Bugzilla/bugzilla_EDA.html" />
    <link rel="prev" title="{Metric name}" href="metric_template.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">AI Supported Continuous Integration</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../README.html">
                    AI4CI : AI for Continuous Integration
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/get-started.html">
   Get Started
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/how-to-contribute.html">
   Contribute to the AI for Continuous Integration Project
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/content.html">
   Table of Contents
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Failure type classifier
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../failure-type-classification/README.html">
   Failure type classification with the TestGrid data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../failure-type-classification/testgrid_flakiness_detection.html">
   Flake Detection for TestGrid
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../failure-type-classification/failure_type_classifier.html">
   Failure type classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../failure-type-classification/failure_type_functions.html">
   Failure type functions
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time to merge prediction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../time-to-merge-prediction/README.html">
   Time to Merge Prediction
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Build Log Classifier
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../gcsweb-ci/build-logs/build_log_EDA.html">
   openshift-ci: build logs initial data collection and EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../gcsweb-ci/build-logs/build_log_term_freq.html">
   Term frequency analysis of build logs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../gcsweb-ci/build-logs/model_seldon.html">
   Seldon deployment for build log clustering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../gcsweb-ci/prow_archive_discovery.html">
   Prow Logs and GCS Data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  TestGrid data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../testgrid_EDA.html">
   TestGrid: initial EDA and data collection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../testgrid_indepth_EDA.html">
   TestGrid In-Depth EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../testgrid_metadata_EDA.html">
   TestGrid: exploring in-depth metadata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../background/testgrid_feature_confirmation.html">
   TestGrid Additional Features - uniform or unique?
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="README.html">
   KPI Metrics
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="number_of_flakes.html">
     Quantify Flakes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="build_pass_failure.html">
     Quantify Build Pass/Failure
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="correlated_failures.html">
     Correlated test failure sets per test and average size of correlation sets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="blocked_timed_out.html">
     Tests Blocked and Timed Out Tests
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="pct_fixed_each_ts.html">
     Percent of Failing Tests Fixed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="persistent_failures_analysis.html">
     Persistent Failures Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="probability_to_fail.html">
     Probability To Fail
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="test_pass_failures.html">
     Quantify test pass/failures
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="time_to_test.html">
     Quantify Time to Test
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="time_to_fail.html">
     Time to Fail
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="validate_pipeline.html">
     Validate the succesful running of the Automated Pipeline
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="get_raw_data.html">
     Fetch test grid data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="metric_template.html">
     {Metric name}
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     KPI Metrics Visualization
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Bugzilla Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Bugzilla/bugzilla_EDA.html">
   Bugzilla Data for CI Tests on Testgrid
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Sippy data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Sippy/stage/sippy_EDA.html">
   Sippy Export of OpenShift Data - EDA
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Sippy/stage/sippy-analysis.html">
   SIPPY
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Sippy/sippy_failure_correlation.html">
   Initial EDA
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Telemetry data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Telemetry/telemetry_EDA.html">
   Telemetry Data for CI Clusters
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Workshop
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/prerequisites.html">
   Pre-requisites
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/intro_to_project.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/onboarding.html">
   Onboarding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/git_setup.html">
   Set up Github environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/model_development.html">
   Model Development
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/ml_pipeline.html">
   Create an ML Pipeline using Elyra and Kubeflow Pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/model_deployment.html">
   Model Deployment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/sql_query_engine.html">
   SQL Query Engine - Trino
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../../../docs/workshop/visualization_dashboard.html">
   Visualization Dashboard - Superset
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href=" /v2/gh/aicoe-aiops/ocp-ci-analysis/master?urlpath=lab/tree/notebooks/data-sources/TestGrid/metrics/metric_visualization_generic.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://jupyterhub-opf-jupyterhub.apps.smaug.na.operate-first.cloud/hub/user-redirect/git-pull?repo=https%3A//github.com/aicoe-aiops/ocp-ci-analysis&urlpath=lab/tree/ocp-ci-analysis/notebooks/data-sources/TestGrid/metrics/metric_visualization_generic.ipynb&branch=master"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on JupyterHub"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../../../_static/images/logo_jupyterhub.svg">
  </span>
<span class="headerbtn__text-container">JupyterHub</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/aicoe-aiops/ocp-ci-analysis"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/aicoe-aiops/ocp-ci-analysis/issues/new?title=Issue%20on%20page%20%2Fnotebooks/data-sources/TestGrid/metrics/metric_visualization_generic.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../../../_sources/notebooks/data-sources/TestGrid/metrics/metric_visualization_generic.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ceph-connection">
   Ceph Connection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-kpi-data">
   Get KPI Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helper-function-for-plotting">
   Helper Function for Plotting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-kpis">
   Visualize KPIs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#blocked-timed-out">
     Blocked Timed Out
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-blocked-tests">
       Number of blocked tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#blocked-tests-percentage">
       Blocked tests percentage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-timed-out-tests">
       Number of timed out tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#percentage-of-tests-timed-out">
       Percentage of tests timed out
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-pass-failure">
     Build Pass Failure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-builds-passed">
       Number of builds passed
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#build-pass-percentage">
       Build pass percentage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-build-failures">
       Number of build failures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#build-failure-percentage">
       Build failure percentage
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#number-of-flakes">
     Number of Flakes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-flaky-tests">
       Number of flaky tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#flake-severity">
       Flake Severity
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#percent-fixed-each-timestamp">
     Percent Fixed each Timestamp
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#percent-of-tests-fixed">
       Percent of Tests Fixed
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#persistent-failures">
     Persistent Failures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mean-length-of-failures">
       Mean Length of Failures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mean-time-to-fix">
       Mean Time to Fix
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#consecutive-failure-rate">
       Consecutive Failure Rate
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pass-to-fail-rate">
       Pass to Fail Rate
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fail-to-pass-rate">
       Fail to Pass Rate
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-pass-failures">
     Test Pass Failures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-passing-tests">
       Number of passing tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-pass-percentage">
       Test pass percentage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-failing-tests">
       Number of failing tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-failure-percentage">
       Test failure percentage
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-to-test">
     Time to Test
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#average-time-to-test">
       Average Time to Test
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>KPI Metrics Visualization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ceph-connection">
   Ceph Connection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-kpi-data">
   Get KPI Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#helper-function-for-plotting">
   Helper Function for Plotting
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualize-kpis">
   Visualize KPIs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#blocked-timed-out">
     Blocked Timed Out
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-blocked-tests">
       Number of blocked tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#blocked-tests-percentage">
       Blocked tests percentage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-timed-out-tests">
       Number of timed out tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#percentage-of-tests-timed-out">
       Percentage of tests timed out
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-pass-failure">
     Build Pass Failure
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-builds-passed">
       Number of builds passed
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#build-pass-percentage">
       Build pass percentage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-build-failures">
       Number of build failures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#build-failure-percentage">
       Build failure percentage
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#number-of-flakes">
     Number of Flakes
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-flaky-tests">
       Number of flaky tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#flake-severity">
       Flake Severity
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#percent-fixed-each-timestamp">
     Percent Fixed each Timestamp
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#percent-of-tests-fixed">
       Percent of Tests Fixed
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#persistent-failures">
     Persistent Failures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mean-length-of-failures">
       Mean Length of Failures
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#mean-time-to-fix">
       Mean Time to Fix
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#consecutive-failure-rate">
       Consecutive Failure Rate
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#pass-to-fail-rate">
       Pass to Fail Rate
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#fail-to-pass-rate">
       Fail to Pass Rate
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-pass-failures">
     Test Pass Failures
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-passing-tests">
       Number of passing tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-pass-percentage">
       Test pass percentage
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#number-of-failing-tests">
       Number of failing tests
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-failure-percentage">
       Test failure percentage
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#time-to-test">
     Time to Test
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#average-time-to-test">
       Average Time to Test
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="kpi-metrics-visualization">
<h1>KPI Metrics Visualization<a class="headerlink" href="#kpi-metrics-visualization" title="Permalink to this headline">#</a></h1>
<p>We use key performance indicators, or KPIs, to measure the effectiveness of CI testing processes and understand how to improve them. These KPIs are calculated in notebooks and saved as different metrics. You can see a list of the available metrics and the notebooks that calculate them <a class="reference external" href="https://github.com/aicoe-aiops/ocp-ci-analysis/tree/master/notebooks/data-sources/TestGrid/metrics">here</a>.</p>
<p>Through this notebook, we want to provide a way for users to explore and visualize the available metrics. Although we plan on setting up external tools (such as Apache Superset) for visualization, we also want to provide the option to visualize KPIs in a Jupyter notebook native environment since that is where a lot of data science development happens.</p>
<p>In this notebook, we plot basic time series graphs for each of the KPI metrics aggregated across all TestGrid dashboards,jobs and tests to visualize how the KPI metric values change over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import required libraries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span><span class="p">,</span> <span class="n">find_dotenv</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="kn">from</span> <span class="nn">ipynb.fs.defs.metric_template</span> <span class="kn">import</span> <span class="n">CephCommunication</span>

<span class="n">load_dotenv</span><span class="p">(</span><span class="n">find_dotenv</span><span class="p">())</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Specify variables</span>

<span class="c1">## CEPH Bucket variables</span>
<span class="c1">## Create a .env file on your local with the correct configs</span>
<span class="c1">## Follow this example - https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/.env-example</span>
<span class="n">s3_endpoint_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_ENDPOINT&quot;</span><span class="p">)</span>
<span class="n">s3_access_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_ACCESS_KEY&quot;</span><span class="p">)</span>
<span class="n">s3_secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_SECRET_KEY&quot;</span><span class="p">)</span>
<span class="n">s3_bucket</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_BUCKET&quot;</span><span class="p">)</span>
<span class="n">s3_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;S3_PROJECT_KEY&quot;</span><span class="p">,</span> <span class="s2">&quot;ai4ci/testgrid/metrics&quot;</span><span class="p">)</span>

<span class="c1"># Specify whether or not we are running this as a notebook or part of an automation pipeline.</span>
<span class="n">AUTOMATION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;IN_AUTOMATION&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ceph-connection">
<h2>Ceph Connection<a class="headerlink" href="#ceph-connection" title="Permalink to this headline">#</a></h2>
<p>We will need to connect to Ceph to fetch all the KPI metric data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Connect to Ceph</span>

<span class="c1"># ceph connector</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">CephCommunication</span><span class="p">(</span><span class="n">s3_endpoint_url</span><span class="p">,</span> <span class="n">s3_access_key</span><span class="p">,</span> <span class="n">s3_secret_key</span><span class="p">,</span> <span class="n">s3_bucket</span><span class="p">)</span>

<span class="c1"># bucket where the KPI metrics are stored</span>
<span class="n">metrics_bucket</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">s3_resource</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="n">s3_bucket</span><span class="p">)</span>

<span class="c1"># get all objects (files) corresponding to all metrics</span>
<span class="n">available_kpi_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="n">s3_path</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="get-kpi-data">
<h2>Get KPI Data<a class="headerlink" href="#get-kpi-data" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># extract the names of unique KPI metric files, and the KPIs available in them</span>
<span class="n">kpis_in_kpifile</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">available_kpi_files</span><span class="p">):</span>
    <span class="c1"># split key into prefix &quot;directory&quot;, metric name, and filename</span>
    <span class="n">dir_name</span><span class="p">,</span> <span class="n">metric_obj_name</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>

    <span class="c1"># update dictionary if key doesnt exist</span>
    <span class="c1"># NOTE: this assumes that the kpis recorded in a kpi filename doesnt change over time</span>
    <span class="c1"># e.g. if pass_fail_2021-6-21.csv had &quot;pass&quot;, &quot;fail&quot;, and &quot;timestamp&quot; columns, so will pass_fail_2021-6-22.csv</span>
    <span class="k">if</span> <span class="n">metric_obj_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kpis_in_kpifile</span><span class="p">:</span>
        <span class="c1"># read a sample file to see what kpis are contained in this file</span>
        <span class="n">sample_file</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">metric_obj_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>

        <span class="c1"># get these kpis names</span>
        <span class="n">kpis</span> <span class="o">=</span> <span class="n">sample_file</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;tab&quot;</span><span class="p">,</span> <span class="s2">&quot;job&quot;</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span>
        <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># update mapping of &quot;filename&quot;: &quot;kpi&quot;</span>
        <span class="n">kpis_in_kpifile</span><span class="p">[</span><span class="n">metric_obj_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">kpis</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>124it [00:34,  3.62it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kpis_in_kpifile</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>defaultdict(list,
            {&#39;avg_correlation&#39;: [&#39;average_number_of_correlated_failures&#39;],
             &#39;blocked_timed_out&#39;: [&#39;test_blocked&#39;, &#39;test_timed_out&#39;],
             &#39;build_pass_failure&#39;: [&#39;test_duration&#39;,
              &#39;build_failure&#39;,
              &#39;build_passing&#39;,
              &#39;build_status&#39;],
             &#39;correlation&#39;: [&#39;test_name&#39;, &#39;correlated_tests&#39;],
             &#39;number_of_flakes&#39;: [&#39;test_duration&#39;, &#39;flake&#39;],
             &#39;pct_fixed_each_ts&#39;: [&#39;pct_fixed&#39;],
             &#39;persistent_failures&#39;: [&#39;consec_fail_rate&#39;,
              &#39;mean_fail_len&#39;,
              &#39;mean_time_to_fix&#39;,
              &#39;pass_to_fail_rate&#39;,
              &#39;fail_to_pass_rate&#39;],
             &#39;test_pass_failures&#39;: [&#39;test_duration&#39;, &#39;failure&#39;, &#39;passing&#39;],
             &#39;time_to_test&#39;: [&#39;test_duration&#39;]})
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="helper-function-for-plotting">
<h2>Helper Function for Plotting<a class="headerlink" href="#helper-function-for-plotting" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plots a linear time series graph</span>
<span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">vals</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="visualize-kpis">
<h2>Visualize KPIs<a class="headerlink" href="#visualize-kpis" title="Permalink to this headline">#</a></h2>
<p>Now, let’s start visualizing each of the KPIs.</p>
<div class="section" id="blocked-timed-out">
<h3>Blocked Timed Out<a class="headerlink" href="#blocked-timed-out" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">blocked_timed_out</span></code> KPI file consists of <code class="docutils literal notranslate"><span class="pre">test_blocked</span></code> and <code class="docutils literal notranslate"><span class="pre">test_timed_out</span></code> metric files which comprise of metric data like number of tests blocked. We will read each of these files and aggregate the metric values across all TestGrid dashboard, job and tests. We can then plot these aggregate metrics values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">blocked_timedout_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;metrics/blocked_timed_out&quot;</span>
<span class="p">)</span>

<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">blocked_vals_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">blocked_percentage</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">timedout_vals_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">timedout_percentage</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">blocked_timedout_files</span><span class="p">:</span>
    <span class="c1"># split into project key and file &quot;path&quot;</span>
    <span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read parquet</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span><span class="p">)</span>

    <span class="c1"># get x and y values to plot for this date</span>
    <span class="n">blocked_vals_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">test_blocked</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">blocked_percentage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">test_blocked</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">timedout_vals_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">test_timed_out</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">timedout_percentage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">test_timed_out</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">kpifile_key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the following metrics from the <code class="docutils literal notranslate"><span class="pre">blocked_timed_out</span></code> KPI file:</p>
<div class="section" id="number-of-blocked-tests">
<h4>Number of blocked tests<a class="headerlink" href="#number-of-blocked-tests" title="Permalink to this headline">#</a></h4>
<p>This metric keeps track of the total number of blocked tests on TestGrid. Lets plot these values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">blocked_vals_to_plot</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;# Blocked Tests&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Blocked Tests&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_15_0.png" src="../../../../_images/metric_visualization_generic_15_0.png" />
</div>
</div>
</div>
<div class="section" id="blocked-tests-percentage">
<h4>Blocked tests percentage<a class="headerlink" href="#blocked-tests-percentage" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of blocked tests on TestGrid. We can visualize the change in percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span> <span class="n">blocked_percentage</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Tests blocked %&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Blocked Test Percentage&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_17_0.png" src="../../../../_images/metric_visualization_generic_17_0.png" />
</div>
</div>
</div>
<div class="section" id="number-of-timed-out-tests">
<h4>Number of timed out tests<a class="headerlink" href="#number-of-timed-out-tests" title="Permalink to this headline">#</a></h4>
<p>This metric keeps track of the total number of timed out tests on TestGrid. Lets plot these values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">timedout_vals_to_plot</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;# Timed Out Tests&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Timed Out Tests&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_19_0.png" src="../../../../_images/metric_visualization_generic_19_0.png" />
</div>
</div>
</div>
<div class="section" id="percentage-of-tests-timed-out">
<h4>Percentage of tests timed out<a class="headerlink" href="#percentage-of-tests-timed-out" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of timed out tests on TestGrid. We can visualize the change in percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span>
    <span class="n">timedout_percentage</span><span class="p">,</span>
    <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Tests timed out %&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Daily Timed Out Tests Percentage&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_21_0.png" src="../../../../_images/metric_visualization_generic_21_0.png" />
</div>
</div>
<p>From the above graphs, we see that there were no blocked tests or timed out tests found.</p>
</div>
</div>
<div class="section" id="build-pass-failure">
<h3>Build Pass Failure<a class="headerlink" href="#build-pass-failure" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">build_pass_failure</span></code> KPI file consists of <code class="docutils literal notranslate"><span class="pre">test_duration</span></code>, <code class="docutils literal notranslate"><span class="pre">build_failure</span></code>, <code class="docutils literal notranslate"><span class="pre">build_passing</span></code>, <code class="docutils literal notranslate"><span class="pre">build_status</span></code> metric files which comprise of metric data like number of builds passing, number of builds failing etc. We will read each of these files and aggregate the metric values across all TestGrid dashboard, job and tests. We can then plot these aggregate metrics values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">build_pass_failure_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;metrics/build_pass_failure&quot;</span>
<span class="p">)</span>

<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">build_pass_vals_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">build_pass_percentage</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">build_fail_vals_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">build_fail_percentage</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">build_pass_failure_files</span><span class="p">:</span>
    <span class="c1"># split into project key and file &quot;path&quot;</span>
    <span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read parquet</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span><span class="p">)</span>

    <span class="c1"># get x and y values to plot for this date</span>
    <span class="n">build_pass_vals_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">build_passing</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">build_pass_percentage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">build_passing</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">build_fail_vals_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">build_failure</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">build_fail_percentage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">build_failure</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">kpifile_key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the following metrics from the <code class="docutils literal notranslate"><span class="pre">build_pass_failure</span></code> KPI file:</p>
<div class="section" id="number-of-builds-passed">
<h4>Number of builds passed<a class="headerlink" href="#number-of-builds-passed" title="Permalink to this headline">#</a></h4>
<p>This metric tracks the total number of builds that were passing. Lets plot these values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">build_pass_vals_to_plot</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;# Passing Builds&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Build Passes&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_27_0.png" src="../../../../_images/metric_visualization_generic_27_0.png" />
</div>
</div>
</div>
<div class="section" id="build-pass-percentage">
<h4>Build pass percentage<a class="headerlink" href="#build-pass-percentage" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of builds that were passing. We can visualize the change in percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span>
    <span class="n">build_pass_percentage</span><span class="p">,</span>
    <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Builds passed %&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Daily Build Pass Percentage&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_29_0.png" src="../../../../_images/metric_visualization_generic_29_0.png" />
</div>
</div>
<p>From the above graphs, we see that on an average about ~50% of builds pass.</p>
</div>
<div class="section" id="number-of-build-failures">
<h4>Number of build failures<a class="headerlink" href="#number-of-build-failures" title="Permalink to this headline">#</a></h4>
<p>This metric tracks the total number of builds that were failing. Lets plot these values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">build_fail_vals_to_plot</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;# Build Failures&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Build Failures&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_32_0.png" src="../../../../_images/metric_visualization_generic_32_0.png" />
</div>
</div>
</div>
<div class="section" id="build-failure-percentage">
<h4>Build failure percentage<a class="headerlink" href="#build-failure-percentage" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of builds that were failing. We can visualize the change in percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span>
    <span class="n">build_fail_percentage</span><span class="p">,</span>
    <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Builds failed %&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Daily Build Failure Percentage&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_34_0.png" src="../../../../_images/metric_visualization_generic_34_0.png" />
</div>
</div>
<p>From the above graphs we see that on an average about ~50% of builds fail i.e there is a 50-50 chance for a build to either pass or fail.</p>
</div>
</div>
<div class="section" id="number-of-flakes">
<h3>Number of Flakes<a class="headerlink" href="#number-of-flakes" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">number_of_flakes</span></code> KPI file consists of <code class="docutils literal notranslate"><span class="pre">test_duration</span></code> and <code class="docutils literal notranslate"><span class="pre">flake</span></code> metric files which comprise of metric data like number of flakes. We will read each of these files and aggregate the metric values across all TestGrid dashboard, job and tests. We can then plot these aggregate metrics values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num_flakes_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;metrics/number_of_flakes&quot;</span><span class="p">)</span>

<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">num_flakes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">flake_severity</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">num_flakes_files</span><span class="p">):</span>
    <span class="c1"># split into project key and file &quot;path&quot;</span>
    <span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read parquet</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span><span class="p">)</span>

    <span class="c1"># get x and y values to plot for this date</span>
    <span class="n">num_flakes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">flake</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="n">flake_severity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">flake</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">kpifile_key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16it [07:50, 29.44s/it]
</pre></div>
</div>
</div>
</div>
<p>Lets plot the following metrics from the <code class="docutils literal notranslate"><span class="pre">number_of_flakes</span></code> KPI file:</p>
<div class="section" id="number-of-flaky-tests">
<h4>Number of flaky tests<a class="headerlink" href="#number-of-flaky-tests" title="Permalink to this headline">#</a></h4>
<p>This metric keeps track of the number of “flaky” tests found. Lets plot these values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">num_flakes</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;# Flaky tests&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Flaky Tests&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_40_0.png" src="../../../../_images/metric_visualization_generic_40_0.png" />
</div>
</div>
</div>
<div class="section" id="flake-severity">
<h4>Flake Severity<a class="headerlink" href="#flake-severity" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of flakes by test overall. This can also be seen as a severity level or overall flake rate of test. We can visualize the change in flake severity over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">flake_severity</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Flake Severity&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Flake Severity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_42_0.png" src="../../../../_images/metric_visualization_generic_42_0.png" />
</div>
</div>
<p>From the above graphs, we see that the number of flakes has increased over time and there were more “flaky” tests found.</p>
</div>
</div>
<div class="section" id="percent-fixed-each-timestamp">
<h3>Percent Fixed each Timestamp<a class="headerlink" href="#percent-fixed-each-timestamp" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">pct_fixed_each_ts</span></code> KPI file consists of <code class="docutils literal notranslate"><span class="pre">pct_fixed</span></code> metric file which comprises of metric data such as percentage of tests fixed. We will read each of these files and aggregate the metric values across all TestGrid dashboard, job and tests. We can then plot these aggregate metrics values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pct_fixed_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;metrics/pct_fixed_each_ts&quot;</span><span class="p">)</span>

<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pct_fixed_vals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pct_fixed_files</span><span class="p">:</span>
    <span class="c1"># split into project key and file &quot;path&quot;</span>
    <span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read parquet</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span><span class="p">)</span>

    <span class="c1"># get x and y values to plot for this date</span>
    <span class="n">pct_fixed_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">pct_fixed</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">kpifile_key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the following metric for the <code class="docutils literal notranslate"><span class="pre">pct_fixed_each_ts</span></code> KPI file:</p>
<div class="section" id="percent-of-tests-fixed">
<h4>Percent of Tests Fixed<a class="headerlink" href="#percent-of-tests-fixed" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of tests that were failing in the previous run of the build, but are now passing. Lets plot the values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">pct_fixed_vals</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Tests fixed %&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Percentage of Tests Fixed&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_48_0.png" src="../../../../_images/metric_visualization_generic_48_0.png" />
</div>
</div>
<p>From the above graph, we see that the percentage of tests fixed has increased over time which is a good indication of more tests passing over time.</p>
</div>
</div>
<div class="section" id="persistent-failures">
<h3>Persistent Failures<a class="headerlink" href="#persistent-failures" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">persistent_failures</span></code> KPI file consists of <code class="docutils literal notranslate"><span class="pre">consec_fail_rate</span></code>, <code class="docutils literal notranslate"><span class="pre">mean_fail_len</span></code>, <code class="docutils literal notranslate"><span class="pre">mean_time_to_fix</span></code>, <code class="docutils literal notranslate"><span class="pre">pass_to_fail_rate</span></code> and <code class="docutils literal notranslate"><span class="pre">fail_to_pass_rate</span></code> metric files. We will read each of these files and aggregate the metric values across all TestGrid dashboard, job and tests. We can then plot these aggregate metrics values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">persistent_failure_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;metrics/persistent_failures&quot;</span>
<span class="p">)</span>

<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mean_length_failures</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mean_time_to_fix</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">consecutive_failure_rate</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pass_to_fail_rate</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fail_to_pass_rate</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">persistent_failure_files</span><span class="p">:</span>
    <span class="c1"># split into project key and file &quot;path&quot;</span>
    <span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read parquet</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span><span class="p">)</span>

    <span class="c1"># get x and y values to plot for this date</span>
    <span class="n">mean_length_failures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">mean_fail_len</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">mean_time_to_fix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">mean_time_to_fix</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">consecutive_failure_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">consec_fail_rate</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">pass_to_fail_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">pass_to_fail_rate</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">fail_to_pass_rate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">fail_to_pass_rate</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">kpifile_key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets plot the metrics from the <code class="docutils literal notranslate"><span class="pre">persistent_failures</span></code> KPI file:</p>
<div class="section" id="mean-length-of-failures">
<h4>Mean Length of Failures<a class="headerlink" href="#mean-length-of-failures" title="Permalink to this headline">#</a></h4>
<p>This metric helps keep track of how many times was the build (test suite) run before a failing test started to pass. Lets plot these values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span>
    <span class="n">mean_length_failures</span><span class="p">,</span>
    <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Length of failure&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Daily Mean Length of Failures&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_54_0.png" src="../../../../_images/metric_visualization_generic_54_0.png" />
</div>
</div>
</div>
<div class="section" id="mean-time-to-fix">
<h4>Mean Time to Fix<a class="headerlink" href="#mean-time-to-fix" title="Permalink to this headline">#</a></h4>
<p>This metric measures how much time was taken before a failing test started to pass. Lets plot these values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span>
    <span class="n">mean_time_to_fix</span><span class="p">,</span>
    <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Mean Time to Fix (minutes)&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Daily Mean Time to Fix&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_56_0.png" src="../../../../_images/metric_visualization_generic_56_0.png" />
</div>
</div>
<p>From the above graph, we see that the mean time to fix on an average has reduced over time i.e lesser time is being taken before a failing test starts to pass.</p>
</div>
<div class="section" id="consecutive-failure-rate">
<h4>Consecutive Failure Rate<a class="headerlink" href="#consecutive-failure-rate" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of failing tests stay failing for more than one build. That is, what percentage of failing tests are not “one-off” failures. We can visualize the change in percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span>
    <span class="n">consecutive_failure_rate</span><span class="p">,</span>
    <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Failure Rate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Daily Consecutive Failure Rate&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_59_0.png" src="../../../../_images/metric_visualization_generic_59_0.png" />
</div>
</div>
<p>From the above graph we see that the consecutive failure rate is on an average ~0.0125.</p>
</div>
<div class="section" id="pass-to-fail-rate">
<h4>Pass to Fail Rate<a class="headerlink" href="#pass-to-fail-rate" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of test runs resulted in a “pass” to “fail” transition. We can visualize the change in percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">pass_to_fail_rate</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Pass to fail rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Pass to Fail Rate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_62_0.png" src="../../../../_images/metric_visualization_generic_62_0.png" />
</div>
</div>
<p>From the above graph, we see that the pass to fail rate for tests has not been consistent.</p>
</div>
<div class="section" id="fail-to-pass-rate">
<h4>Fail to Pass Rate<a class="headerlink" href="#fail-to-pass-rate" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of test runs resulted in a “fail” to “pass” transition. We can visualize the change in percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">fail_to_pass_rate</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Fail to pass rate&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Fail to Pass Rate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_65_0.png" src="../../../../_images/metric_visualization_generic_65_0.png" />
</div>
</div>
<p>Similary, the fail to pass rate for tests has also been inconsistent.</p>
</div>
</div>
<div class="section" id="test-pass-failures">
<h3>Test Pass Failures<a class="headerlink" href="#test-pass-failures" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">test_pass_failures</span></code> KPI file consists of <code class="docutils literal notranslate"><span class="pre">test_duration</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code> and <code class="docutils literal notranslate"><span class="pre">failing</span></code> metric files which comprise of metric data such as number of tests passing, number of failing tests etc. We will read each of these files and aggregate the metric values across all TestGrid dashboard, job and tests. We can then plot these aggregate metrics values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_pass_failure_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span>
    <span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;metrics/test_pass_failures&quot;</span>
<span class="p">)</span>

<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_pass_vals_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_pass_percentage</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_fail_vals_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_fail_percentage</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">test_pass_failure_files</span><span class="p">:</span>
    <span class="c1"># split into project key and file &quot;path&quot;</span>
    <span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read parquet</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span><span class="p">)</span>

    <span class="c1"># get x and y values to plot for this date</span>
    <span class="n">test_pass_vals_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">passing</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">test_pass_percentage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">passing</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">test_fail_vals_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">failure</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">test_fail_percentage</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">failure</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)),</span>
    <span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">kpifile_key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Lets plot the following metrics from the <code class="docutils literal notranslate"><span class="pre">test_pass_failures</span></code> KPI file:</p>
<div class="section" id="number-of-passing-tests">
<h4>Number of passing tests<a class="headerlink" href="#number-of-passing-tests" title="Permalink to this headline">#</a></h4>
<p>This metric keeps track of the total number of test runs that passed successfully. Lets plot the values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">test_pass_vals_to_plot</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;# Passing Tests&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Test Passes&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_71_0.png" src="../../../../_images/metric_visualization_generic_71_0.png" />
</div>
</div>
</div>
<div class="section" id="test-pass-percentage">
<h4>Test pass percentage<a class="headerlink" href="#test-pass-percentage" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of test runs that passed successfully. We can visualize the change in the test pass percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">test_pass_percentage</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Test Pass %&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Test Pass Percentage&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_73_0.png" src="../../../../_images/metric_visualization_generic_73_0.png" />
</div>
</div>
</div>
<div class="section" id="number-of-failing-tests">
<h4>Number of failing tests<a class="headerlink" href="#number-of-failing-tests" title="Permalink to this headline">#</a></h4>
<p>This metric keeps track of the total number of test runs that failed. Lets plot the values for each day.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">test_fail_vals_to_plot</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;# Failing Tests&quot;</span><span class="p">,</span> <span class="s2">&quot;Daily Test Failures&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_75_0.png" src="../../../../_images/metric_visualization_generic_75_0.png" />
</div>
</div>
</div>
<div class="section" id="test-failure-percentage">
<h4>Test failure percentage<a class="headerlink" href="#test-failure-percentage" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the percentage of test runs that failed. We can visualize the change in the test failure percentage over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span>
    <span class="n">dates</span><span class="p">,</span>
    <span class="n">test_fail_percentage</span><span class="p">,</span>
    <span class="s2">&quot;Day&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Test Failure %&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Daily Test Failure Percentage&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_77_0.png" src="../../../../_images/metric_visualization_generic_77_0.png" />
</div>
</div>
<p>From the above graphs, we see that overall there has been an increase in the number of tests failing daily, however this increase is low i.e ~3000-7000 compared to the number of tests passing daily i.e. ~70000-95000.</p>
</div>
</div>
<div class="section" id="time-to-test">
<h3>Time to Test<a class="headerlink" href="#time-to-test" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">time_to_test</span></code> KPI file consists of the <code class="docutils literal notranslate"><span class="pre">test_duration</span></code> metric file which comprises of metric data such as test run times. We will read each of these files and aggregate the metric values across all TestGrid dashboard, job and tests. We can then plot these aggregate metrics values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_to_test_files</span> <span class="o">=</span> <span class="n">metrics_bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="s2">&quot;metrics/time_to_test&quot;</span><span class="p">)</span>

<span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">avg_test_duration</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">time_to_test_files</span><span class="p">:</span>
    <span class="c1"># split into project key and file &quot;path&quot;</span>
    <span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># read parquet</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read_from_ceph</span><span class="p">(</span><span class="n">project_bucket</span><span class="p">,</span> <span class="n">kpifile_key</span><span class="p">)</span>

    <span class="c1"># get x and y values to plot for this date</span>
    <span class="n">avg_test_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">test_duration</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">kpifile_key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the following metric from the <code class="docutils literal notranslate"><span class="pre">time_to_test</span></code> KPI file:</p>
<div class="section" id="average-time-to-test">
<h4>Average Time to Test<a class="headerlink" href="#average-time-to-test" title="Permalink to this headline">#</a></h4>
<p>This metric calculates the average time taken to run builds. We can visualize the change in the average time taken over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">avg_test_duration</span><span class="p">,</span> <span class="s2">&quot;Day&quot;</span><span class="p">,</span> <span class="s2">&quot;Time to Test (minutes)&quot;</span><span class="p">,</span> <span class="s2">&quot;Average Time to Test&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../../_images/metric_visualization_generic_83_0.png" src="../../../../_images/metric_visualization_generic_83_0.png" />
</div>
</div>
<p>From the above graph, we see that the average test duration has slightly increased over time and been in the range of ~85-89 minutes.</p>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">#</a></h2>
<p>In this notebook, we have tried to read the collected metrics from ceph and use visualization libraries like <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> to explore our data. We have aggregated the metric values across all TestGrid dashboards, grids and tests and plotted time series graphs to visualize the change in the metric values over time. This provides us an initial understanding of the KPI metrics at the TestGrid platform level and we can further create in-depth visualizations for each of the individual KPI metrics.</p>
<p>For future work, we could look into exploring more visualization tools for further detailed analyses.</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/data-sources/TestGrid/metrics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="metric_template.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">{Metric name}</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../Bugzilla/bugzilla_EDA.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Bugzilla Data for CI Tests on Testgrid</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By AIOps<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>